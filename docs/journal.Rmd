---
output:
  pdf_document: default
urlcolor: blue
---

30.5.2024

OK, grem 캜ez 1_Macro_PROD.R od Katarine. Plan je popeglat in predvsem na koncu namesto v access zapisati v postgres bazo, kjer moram 코e pripravit tabele. Ampak gremo najprej 캜ez kodo. 

Pazi, da je nov eurostat nalo쬰n, s starej코o verzijo ni delalo. 
Dodam opise spremenjljivk iz Eurostata, druga캜e ni캜 ne razumem, pa za dokumentacijo je treba to vedet. Aja, `label_eurostat() ` je fajn.

GDP in EMP downloada za razli캜ne geo, pri GDP manjka eu28, ampak je 27 podvojen. Ravno tako pri GDP ni UK, pri EMP pa je. konsolidiram oboje. 

Datum pri EMP je do 2022, pri GDP do 2023, konsolidiram oboje in prestavim time range na za캜etek. 

V bistvu ima `get_eurostat()` 쬰 mo쬹ost filtrov, tako da nima smisla downloadat cele bulk tabele, 캜e lahko 쬰 tam filtre nastavim, tako da gremo raje tako. 

ok, gremo naprej, kode dr쬬v delam bolj pregledne, country_code_EA_noIE je po moji logiki euro brez irske? ampak irska je not, ni pa hrva코ke? to je za preverit. Roti potrdila, vr쬰m ven IE in dodam HR

Naslednji korak je dodajanje aggregatov za neki skupin dr쬬v, kar se ponovi za vse 3 tabele, zato naredim raje funkcijo. 

OK, clean up kode je kon캜an, zdaj pa samo 코e imena stolpcev, potrjena s strani Rotije.

CP_MPPS_EU27_2020_B1GQ	BDP, teko캜e cene, v mio SKM (EU27 od 2020)
CLV10_MEUR_B1GQ	BDP, stalne cene leta 2010, v mio EUR
THS_PER_EMP_DC	Skupna zaposlenost, doma캜i koncept, v 1000 oseb
 THS_HW_EMP_DC	Delovne ure, doma캜i koncept, v 1000
THS_PER_POP_NC	맚. Prebivalcev, nacionalni koncept, v 1000
GDP_PC_PPS 	BDP na prebivalca v SKM
PROD_PPS 	Produktivnost v SKM, na zaposlenega
PROD_PPS_HW	Produktivnost v SKM, na delovno uro
PROD_real  	Realna produktivnost, na zaposlenega
PROD_real_HW  	Realna produktivnost, na delovno uro
EMP_RATE	Dele zaposlenih v celotnem prebivalstvu
HW_EMP  	Delovne ure na zaposlenega
GDP_PC_PPS_EU27_100	BDP pc v SKM (indeks EU27 2020 = 100)
PROD_PPS_EU27_100 	Produktivnost v SKM (indeks EU27 2020 = 100), na zap.
PROD_PPS_EU27_100_HW	Produktivnost v SKM (indeks EU27 2020 = 100), na delovno uro
EMP_RATE_EU27_100 	Stopnja zaposlenosti (indeks EU27 2020 = 100)
GDP_PC_PPS_EU27_100 	Delovne ure na zap. (indeks EU27 2020 = 100)

Evo, za konec 코e na hitro na lokalni bazi testno naredim tabelo in zapi코em, vse dela super. 

# 3.6.2024

Started on the documentation in `umar_produktivnost-tehni캜na_dokumentaciona.Rmd`. 

Actually let's add the tidy version of the table as well, which means removing the original aggregates, but adding columns for each aggregation. Or maybe adding a table with the aggregations, to keep things normalised. 

OK, created `00_geo_lookup.R` where the lookup table is created. Also added EA20, cuz it didn't exist in the original set. The question is whether the tidy table should include teh country grouping columns, which would be familiar to people or not. I wonder if anyone will even use this ever, so maybe not, cuz that's clean af. 

Lemme check the aggregations tho. I mena compare the eurostat ones with mine. 

# 4.6.2024

OK, got the OBDC connection to the database to work on the new computer and added the instructions to the technical documentation. 

# 6.6.2024

OK, dodajam  코e demo_pjan, za dekompozicijo bdp na preb z delovno aktivnim preb. tu je problem, ker se total ne se코teje enako kot prebivalstvo po nacionalnem konceptu. bomo probal oboje, da vidimo kolk je sploh ta razlika. 

OK, gremo gledat najprej te razlike med eurostat agregati in izra캜unanimi. EU28 in EU15 sta v bistvu passe, ker se kon캜ata 2020, tako da vpra코anje, 캜e se 코e uporabljajo. Isto EA19 verjetno, ki ga 코e ra캜unajo, ampak EU27 pa je verjento najbolj aktualen, ampak se razlikuje od izra캜unanega. Roti in Ur코ka 캜 pravita, da je samo EU20 relevanten. 


# 10.6. 

OK, zdej soem dodala 코e dekompozicijo po working age population, ker so podatki iz druge tabele je v dokumentaciji tudi analiza razlik. 

Trenutno zapisujem na lokalno bazo, ampak to se hitro prestavi, ko dobijo drugi driverje, da sploh laho dostopajo. 

Tabela produktivnost_makro je postavljena, tako da gremo na naslednjo skripto i guess?

Aja, dodala 코e geo lookup tabelo in v produktivnost marko stolpec aggr, da ve코 katere so ne-agregirane.

OK, 2. skripta. Zdru쬴la dve tabeli share shift dekompozicije na zaposlenega in na delovno uro. In mal preimenovala spremenljivke, zato da so lahko skupaj, in da so konsistentne. In dodala 코e vsoto stati캜ne in dimani캜ne strukturne spremembe. In tabela je v bazi tudi. 

ok, dejmo prestavit zdej to na produkcijo in dat Roti in Ur코ki username-e. 

```
SELECT current_database();
SELECT current_database();
CREATE USER rotija WITH PASSWORD 'xxx';
CREATE USER urska_cede WITH PASSWORD 'xxx';

-- Grant usage on the schema
GRANT USAGE ON SCHEMA produktivnost TO rotija;
GRANT USAGE ON SCHEMA produktivnost TO urska_cede;

-- Grant select on all current tables in the schema
GRANT SELECT ON ALL TABLES IN SCHEMA produktivnost TO rotija;
GRANT SELECT ON ALL TABLES IN SCHEMA produktivnost TO urska_cede;

-- Ensure future tables inherit these permissions
ALTER DEFAULT PRIVILEGES IN SCHEMA produktivnost GRANT SELECT ON TABLES TO rotija;
ALTER DEFAULT PRIVILEGES IN SCHEMA produktivnost GRANT SELECT ON TABLES TO urska_cede;
```

OK, zdej rabim 코e IP-je, Ur코ka je 172, potem pa tud 코e doma캜e, ampak ok, otom potom. 

# 12.6.

OK, gremo dokumentirat tale shift share. 

Ah, nace aggregates so 3 nivoji, dajmo to lo캜it. OK, dodala stolpec, da se lo캜i te agregatne nivoje med sabo. V bistvu kasjeje Katarina tudi doda ene skd grupacije, zakaj jih ne bi 쬰 zdej za te dekompozicije? In tud agregacije za geografije ima dodane samo za zadnjo tabelo, pa ni razloga, da jih ne bi tudi 쬰 zdaj. OK; namesto treh tabel bo samo ena. 

Za skd agregacije naredim novo skripto `00_skd_lookup.R`. 

OK, dokumentacija za shift share, pain in the but, ampak mislim, da je. Bom dala Ur코ki, da pregleda. 

Pa preselim mapo na O:avtomatizacija. 

# 13.6.

OK, gremo 3. skripto. popravljam v glavnem samo, da se dr쬴 iste sktrukture kot prej코nji dve. 

Aja, v bistvu 3. je rulc letno, ne surs, tisto dejmo na koncu. 

Tukaj sta dva dela, en s totali in en po skd. prvi je iz `nama_10_gdp`, drugi pa `nama_10_a10`.

OK, 3 skd sem naredila, ampak na oko so podatki na 3, 4 decimalki druga캜ni kot nazadnje shranjeni v access - in to za 1995, kar se valda ne spreminja? jutri naprej. Aha, prav je, isto dobim s Katarinino skripto, tako da so spreminjal neki o캜itno. 

# 17.6.

Vpra코anja za Rotijo/Ur코ko
-	Letne podatke sem dala z letnico (1995) in ne datumom (1.1.1995), je to OK?
- RULC podatki imajo indekse izra캜unane za 2005, 2007 in 2008 bazna leta, a so te letnice 코e vse relevantne, ali ni dodali kak코ne druge?
- RULC 캜etrt캜etni totals so za seasonaly adjusted in NSA, NACE pa samo za NSA. 
- RULC totals so z BDP-jem, rulc NACE pa z DV-jem?
- Rulc letni totals imajo poleg sredstev za zaposlene tudi pla캜e in prispevke in pri zaposlenosti tudi samozaposlene, medtem ko pri NACE tabeli ni pla캜e in prispevkov, niti samozaposlenih. Jih dodam vseeno?



ok, kon캜ala 캜etrtletnega tudi, ena napakica pri Katarini pri rename-u na koncu. 

OK, nenavadno, v캜asih dbexecute, ki ima create table in je time date, ne dela prav in time rata int. ne razumem zakaj. 캜e isti sql po쬰nem direkt iz dbeaverja, pa dela ok. 

Na코la napako v trojki, DV rename namesto BDP. Bom naredila kar dva stolpca z imeni indikatorjev, da so konsistentni z ostalimi tabelami. 

OK, trojka narejena, dokumentirana. mal sem preimenovala tabele, upam, da sem povsod prav napisala. 

OK, za캜ela peglat rulc total 캜etrtletni. mal preve캜 vrstic ma zgleda, naslednji teden naprej.. 

# 24.6.2024

ok, se pravi imena indikatorjev dodat v 코tirki pa to. OK, to je narejeno in dokumentacija dodana. 
Gremo zdej 코e surs narest. 

# 26.6.2024

OK, v sursu, K. uporabi zoo funkcijo as.yearqtr, ki doda presledek ampak je tud nek class o캜itno, ne vem a je to potrebno in zakaj tega pol ni v ostalih 캜etrtletnih skriptah.

Ta skripta je tako konfuzna, jao. OK, mamo DV, zaposlenost in stro코ke. dv + zap je produktivnost. dv ima dve meritvi, zap pa 코tiri. se pravi produktivnost jih ima 코est pol. 

stroski imajo samo eno. potem obema, str in prod popravi코 skd oznake na kratke. in pobri코e코 dodatne stolpce. in ju da코 skupaj - join. 1404 vrstic trenutno. to je zdej rulc .

na tej to캜ki naredi코 sektorjske agregate (menjalni, poslovni) ampak K to naredi samo na produktivnosti for some reason. in prera캜une tudi. se pravi v tabeli brez stro코kov dela. 캜eprav je 쬰 naredila rulc tabelo. prod tabela je 코iroka, v resnici je to shift share tabela, 캜e prav vidim. ok, to bomo naredil z istimi imeni stolpcev kot so 쬰 v shift share.

za rulc potem tud naredi agregate sektorske in hkrati 코e BCDE minus C = BDE. 캜esar na ni pri shift share-u. bomo 코e tam dodali. 

jesus 0300220S.px je ful glupa tabela, kao dodana vrednost po SKDjih, in potem je 코e ena serija za skupaj in na koncu 코e BDP, seveda skupaj. ampak wtf nej s tem po캜ne 캜lovk. Pa zmedlo me je, ker ga Katarina ni eksplicitno ven vrga, in ji pade ven 코ele z merge-om z zaposlitvioj. 

# 1.7.2024

fuck, problem s temi sursovimi tabelami je, da niso tidy, ker imajo not BCDE in C, kar je cela jeba pol, ko ho캜em recimo menjalne grupirat. moram za surs nove grupe narest o캜itno.. 

rotijo vpra코ala za imenovanje spremenljivk. damo emp in hw na konec in real in nom na sredino. spremenljivka pa je spredi. 

ok, kon캜ala shift share in rulc 캜etrtletno

sem pa preimenovala vse spremenljivke in moram to zdaj popraviti 코e na 02, 03 in 04. 

# 2.7.24

OK, naredila skripto 2, dodala par spremenljivk, da je isto kot pri sursu, preimenovala in popravila sql in dokumentacijo. 

gremo 3. ok, letne BDP in letne VA narejene. 4. tudi. in dokumentacija je vsa ok. samo 코e preverit je treba cifre na hitro.

OK, 5. imamo 캜etrtletni shift share in RULC narejen, manjka zapis na bazo in 코e dokumentacija

5. bomo razdelil 코e na 6. za letne. ampak tam mi niso jasni prod_A_det in prod_A_SKD. ta drugi OK, so samo top level SKD-ji. ta prvi pa so 2. level, ampak hkrati so zraven 코e B; D; itd, in hkrati izlo캜en 12 (toba캜ni). aha, po코tekala, tale tabela na SiStatu: https://pxweb.stat.si/SiStatData/pxweb/sl/Data/-/0301915S.px ima namre캜 nenavadno klasifikacijo po SKD, kjer so ene stvari na 1. in potem raz캜lenjene na 2. nivoju, ene pa samo na 1. nivoju. Tako da je zbrisala ven recimo A in C, ker sta oba raz캜lenjena na 2. in pustila B, ker ni raz캜lenjen (to so te ta brezvezni sektorji 游땔)

Tako naredi potem 췉tidy춺 tabelo, se pravi se ni캜 ne podvaja, oz. vsota vsega je vsota gospodarstva. Minus toba캜ni izdelki

OK, se pravi 캜etrtletne imamo zdej prod Q in rulc Q, potem sta 코e tot_rulc_q in tot_prod_q, ampak slednja je samo 코ir코a verzija rulca (ki ima 코e rulc komponente), zato je ne bom delala. 

Potem pa je 코e rulc_a_q, za katerega pa ni kode, ampak tabela itak izgleda ista kot RULC_Q, tako da to tudi presko캜imo... 

Se pravi imamo zdej 
SURS_shift_share_캜etrtletni (prej prod_q)
SURS_RULC_VA_SKD_캜etrtletni (prej RULC_q)
SURS_RULC_BDP_total_캜etrtletni (prej TOT_RULC_q)

# 3.7.2024

aha, pri eurostatu smo za 캜etrtletje imel datume, dejmo tud pri sursu pol valda. OK, dodala. 
Zdej dokumentacijo za 05. potem pa 06, letne. 
OK, dokumentacija za 05 je ok.
dodala 코e linke na tabele pri skriptah, tudi za 04, treba 코e za ostale. 
in preveri preimenovanja tabel
in preveri podatke. 

# 4.7.2024

OK, dodala linke na tabele pri ostalih skriptah. Dodala tudi vsem lokacije prej코njih tabel. 
Gremo 코e podatke preverit za nazaj.

OK, pri produktivnosti makro so agregati narobe, po moje se podvajajo jebemti. 

jesus, grem preverjat podatke, svoje in katarinine, in vidim, da se pri eurostatovih realnih dodanih vrednostih razlikujejo, ampak samo pri agregatih tipa menjalni ipd. in grem gledat v 캜em je fora, in je fora, da je Katarina se코tevala A + B-E, jaz pa A+B+C+D+E. in se izka쬰, da so B-E in G-I ipd agregati narobe izra캜unani na Eurostatu. AMpak samo pri realah, nominale so OK. 

OK, to je zaradi chain linked volumes-ov. zato so leta 2010 cifre ok, dlje kot gre코 stran, bolj se razlikujejo, ker chain linked volumes niso aditivni.. in razlike so med dr쬬vami, ker se razlikujejo po ekonomski strukturi, volatilnosti, relativnih spremembah cen med sektorji ipd. ker razlike so tud manj kot en procent, pa do 10 al pa 15 % za HU, CZ, PL recimo. zdej samo ne vem kaj je bolj prav, individualne komponente al 쬰 izra캜unani agregati za vsote.. 

OK, preverila podatke za 02. 03.

Rotija prosila 코e za dva agregata tr쬹e storitve: G-N
ostale dejavnosti: A, B, D, E, O-U.

OK, dodala oba agregata na vse NACE in SKD tabele. In v dokumentacijo povsod - manjkali sta 코e dva NACE 코ifranta, zdej je ok mislim. Preverim 코e podatke na 04, pol pa gremo letne sursove naprej. 

OK, preverila 04. 

# 8.7.2024

ok, letni prod so ok, preverjeni podatki tudi. 

# 9.7.2024

te letne sursove sem 쬰 trikrat okol obrnla. zdej sm vrnila nazaj ostale ravni SKD, ki so manjkale, in dodala stolpce za SKD kode in aggr stolpec. in dokumentacijo za shift share, done, za rulc skd, ok tud z rulc total. 

zbrisala belgijo iz inovatork. 

zdej je vse ok kao na prvo 쬺go. vse skripte so narejene, vse tabele 코timajo, dokumentacija je ok. naslednji korak je task scheduler na코timat in potem to aditivnost it popravit za nazaj. trenutno so vse agregacije za dr쬬ve in skd-je za realne podatke napa캜ne, ampak baje se to da prav narest, za letne la쬵e, za 캜etrtletne te쬵e, ampak bom nekak :)




# 10.7.24
prestavljanje na server ni tolk simle.. problem je source-anje iz automation scripts, ker je drug projekt in drug environment, in pol kr ene stvari ne delajo. zato bom skripto za poganjanje vsega skupaj pustila v umar-produktivnost. samo zdej me pa jebe in코taliranje eurostata in update data.table, ki se kar no캜e. OK, ugasnila vse procese in pol je 코lo.

evo, skripti lo캜eni za eurostat in surs sta narejeni, batch fajla tudi, in scheduling tudi. 

baza je provizori캜no otvorjena. 

naslednja stvar so aditivnosti. Tale [캜lanek](https://www.abs.gov.au/ausstats/abs@.nsf/0/95ce2d6796bd15aeca256db800754639/%24FILE/ATT4T7WF/Demystifying%20Chain%20Volume%20Measures_1.pdf) je kar super, da mi je vsaj pribli쬹o jasno za kaj gre...

# 11.7.24

ok, gremo probat ta additivity. dodam, redundantly, 코e CLV_PCH_PRE kar je chain linked volumes percentage change on pervious period.  in PYP_MEUR, kar je previous year prices. dejmo za za캜etek primerjat EU 15 z mojim agregiranjem. aja, pa CP_MEUR rabim, ki so current prices, ne pa une s PPS valda.. 

OK, se pravi, imam:
teko캜e cene 
stanlne cene preteklega leta
oboje je aditivno. se pravi lahko delam agregate iz tega. 
ko jih se코tejem, lahko potem izra캜unam za agregat stopnjo rasti. in ko imam to, lahko na referen캜no leto naredim chain naprej in nazaj in dobim stalne cene referen캜nega leta za agregate. i think. 

# 15.7.2024

poslala Janezu write up aditivnost.Rmd, kjer mislim, da sem pravilno naredila letne agregacije iz eurostatovih podatkov. grem probat zdej 코e 캜etrtletna, ki mislim, da temeljijo na annual overlap method, vsaj za eurostat, glede na metodologijo [tukaj](https://ec.europa.eu/eurostat/cache/metadata/en/namq_10_esms.htm). 

drek, grem 코e enkrat gledat aditivnost dr쬬v, in je pri teko캜ih cenah in prej코njega leta enostavno ni. sem probala tudi EA19 za 2015-2022, ko sigurno ni te캜ajnih konverzij, ampak 코e vedno se ne se코tejejo pravilno. 

unrelated: total vsote za dodano vrednost se razlikujejo glede na izvorno tabelo: a10 in a64. to velja predvsem za Irsko, Francijo in 맜edsko, kjer so okoli 4% za Irsko, in okoli 0.5-1% za ta drugi dve. 

# 16.7.24

ok, napisala na eurostat prito쬭o. mimgrede, [tuki](https://ec.europa.eu/eurostat/documents/24987/4253460/COMPILING-EU-ACCOUNTS.pdf) je njihov pdf z metodologijo. kjer za캜uda pi코e, da rabi코 samo PYP za delat svoje CLV, ampak [tuki]( https://dsbb.imf.org/sdds/summary-methodology-base/country/EMU/category/NAG00) pa ima IMF zelo podoben tekst, ampak pravilno pi코e CP in PYP.

ok v excelu sprobala letne za surs, dela OK. no, sej to je bilo jasno i guess.

OK, gremo 코e 캜etrtletne za surs probat. najprej aditivnost teko캜ih in predhodnega leta, vse ok, najs. 

# 17.7.2024

ok, ro캜no reverse en쬴niranje 캜etrtletnih chain linked volume-ov. kira jeba. chatgpt, claude, australski statisti캜ni biro, imf in ek. in na koncu sem nekaj spacala skupaj, ampak zgleda ok. dela samo tako, da najprej naredim chain link s prvim letom za referenco in potem rebase-am na 2010 al karkol. in 코e potem je treba nekaj namutit za 1. leto, ampak nekak sem. v excelu dela zdej. 

[tale](https://www.imf.org/external/pubs/ft/qna/pdf/2017/chapterv8.pdf) poglavje je bil najbolj uporaben, tabela 8.6, da sem jo reverse in쬴nirala, ampak 코e potem sem mogla za prvo leto mal namutit, samo je prav zdej. 

ok, in stvar dela ok na surs podatkih, in pol probam na "istih" podatkih iz eurostata, in wtf. se izka쬰, da je CLV serija ista kot na코a, ampak CP in PYP sta pa mal druga캜na in to vedno bolj, bolj nazaj gre코. tako da potem valda ne mora코 prav izra캜unat CLV-ja. od 2010 naprej je ok, prej pa so vedno ve캜ji razkoraki. ne vem, grem 코e eno drugo dr쬬vo probat. pa pizda, 코e dobr, da sem reverse in쬴nirala na sursovih podatkih, druga캜 bi se mi zme코al, 캜e bi imela prav algoritm, ampak imajo oni napa캜ne podatke... Aja, ne, to je zaradi te캜ajev. 캜e uporabi코 national currency, potem pa je prav. Kar pomeni, da moramo za eurostat agregacije to vedno uporabljati? 캛e ne niso primerljivi podatki z na코imi? Al kadar agregiram eurostat agregacije, moram uporabljati MEUR series, ker pi코e, da so tiste suitable for aggregation and internal comparison. 

# 20.7.24

OK, razvozlavanje kako ta chain linked volume, ki ga znam v excelu narest, narest tudi v R-u sploh ni tako enostavno. Ker gre za rekurzivno serijo in dplyr ni narejen  za to v bistvu. Ampak sem po ful matranja na koncu le pogruntala. Tako da imam zdaj funkcijo `chain_linking_quarterly_2010`, ki to dela. Rabim 코e letno, ampak je v bistvu 쬰 narejena, samo v funkcijo jo moram spremenit.


# 22.7.24

OK, zdej pa problem: agregiranje delamo dvakrat: enkrat med SKD-ji in enkrat med dr쬬vami. Ampak vsaj za Slovenijo smo zdaj vidli, da ne sme코 uporabljati MEUR, ampak MNAC. Gremo najprej sprobat to v Excelu, da vidimo, 캜e znam sploh.

# 23.7.24

OK, posku코am zdej pogrnutat kako delujejo MNAC in MEUR. za za캜etek sem vzela EU15, in imam za obe valuti CP, PYP in CLV. CLV meur se izra캜una prav (z manj코imi napakami)za vse razen za Portugalsko, 캜eprav Francija in UK imata tudi malo ve캜jo napako, ampak Portugalska gre do 1.5%... Na 쬬lost imajo oni na svoji strani samo CLV za 2016 objavljen. OK, primerjam portugalske MEUR in njihove objavljene na njihovem sursu in so od 1999 naprej isti za current prices, prej pa so MNAC. Kar smo vidli isto velja za Slovenijo. Ampak to ne razlo쬴 zakaj so CLV na eurostatu napa캜ni in ne sledijo izra캜unu iz CP in PYP.  AMpak ne morem ni캜 kej pametnega preverit, ker itak oni nimajo 2010 objavljenega svojega. Zanimivo, 캜e grem po SKD-jih gledat portugalsko, je B OK, A in C pa ne, niti D. E pa je spet OK. 

OK, Portugalci so o캜itno narobe izra캜unali ene svoje stalne cene. Tudi na njihovi strani, 캜e probam njihove 2016 izra캜unat, so tudi narobe. Sem jim pisala. Peak geek. 

# 24.7.24

OK, 캜akamo na Portugalce, ampak v vsakem primeru moram na코tudirat kako prav agregirat za vse dr쬬ve. 

OK, vzamemo M+N za vse dr쬬ve in aggregacije, v MEUR in MNAC za CP, PYP in CLV2010.

+ najprej check aditivnosti. CP MEUR je ok, razen za 맜edsko 2022. isto CP MNAC. in oba PYPja 0.15 % pribli쬹o. OK, to ignoriramo. 캛eprav je 캜udno, ampak ne grem na 맜edski Surs se zdej 코e tam igrat. 

+ ok, gremo zdej te te캜aje gledat. Zdej 캜e primerjamo oba CLV-ja, je kurz konstanten in sicer tist od leta 2010. 캛e pa gledamo CP ali PYP, pa se spreminjajo dokler je float, potem ko je pa pegged, je kurz stabilen. Aja, tudi, ko je pegged, ni stabilen, ker ERM je dovoljeval malo lufta. Zato So vse pegged valute malo spremenjlive (razen Danske it seems) Aja, Danska je v ERMII in je prostovoljno zmanj코ala fluctuation band na 2.5% namesto 15콯al se teh podatkov ne da nikjer uradno dobit na enem kupu, se pravi za valute ki ne obstajajo ve캜 tipa tolar in belgijski frank. Je tud Matev rekel, da je 캜udno. Ampak pa캜 bom uporabila implicitni te캜aj, ki ga dobim iz teh Eurostat objav v MEUR in MNAC, med serijami so ti te캜aji isti do 4 decimalke, kar je more than enough. 

+ double check teh te캜ajev: isti je za CP kot za PYP (캜eprav tist je seveda zamaknjen za eno leto). Isti so med serijami, recimo M, N in M_N - do 캜etrte decimalke. tako da i guess bom to enkrat naredila in naredila nek 코ifrant, da je pol mir. 

+ OK, actually, i might have had it all wrong. LInki so isti ne glede na to a so izra캜unani iz MEUR ali MNAC. Hm, ampak mogo캜e je to samo pri letnih podatkih, a ne.. OK, letni zgledajo res OK. V eurostat_annual_mnac_meur.xlsx je M+N narejen ya vseh 28 plus aggregate in rayen portugalske zgleda vse prbl ok, se pravi linke lahko vzame코 iz MEUR in se ne rabi코 z MNAC sploh zajebavat. In dobi코 iste rezultate kot so objavljeni za CLV (ki je vedno isti za MEUR in MNAC.

+ OK gremo zdej sprobat to 코e za 캜etrtletne. Za Slovenijo smo 쬰 vidli, da pred 2027 ne 코tima iz MEUR. Za Dansko pa pred 1996 o캜itno. Gremo probat iz MNAC dobit prave cifre torej...

# 25.7.24

OK, gremo 캜etrtletne za vse EU. Tukaj v bistvu ni A64, samo A10 je objavljen, se pravi lahko samo ta total primerjam, ampak je ok. 

Najprej annual averages, problem je da nekatere dr쬬ve nimajo podatka. 캛eprav ve캜ina jih ima. AMpak kaj narest tam, kjer jih ni. Za Slovenijo podatek sicer "je", ampak je povpre캜je isto kot za current price, tako da mogo캜e sploh ni ta prav podatek, ampak je imputiran nekako?

Potem je vpra코anje kaj naredi코 za zadnje 캜etrtletje, ki ni celo leto? Zdaj sem vzela pa캜 njegovo vrednost, bomo vidli kako se izzide. OK, zdadnje je OK, ampak prve 4 niso, samo ne vem kako jih pogruntat. 

  
# 29.7.24


OK, problem so predvsem 1995 letnice, ker tudi, 캜e so podatki za PYP, kot npr za dansko in slovenijo, se linki za prvo leto razlikujejo. Kar mi ni 캜isto jasno zakaj, ker ostali linki so prakti캜no identi캜ni, vsaj na prve tri decimalke. 
Anyway, iz MNAC izra캜unani CLV so vsi pravilni, 0.00% errorja v primerjavi z obljavljenimi.

OK, dr쬬ve z Eurom, recimo Finska:
+ CP so isti od leta prevzema naprej (1999)
+ PYO si isti od enega leta kasneje (2000)
+ CLV so isti za celo obdobje ?
+ CLV izra캜unan iz MEUR je pravilen od leta prevzema naprej 1999
+ CLV iz MNAC izra캜unan je pravilen za celo obdobje. 

Isto velja za Slova코ko, Slovenijo. 
Torej za te dr쬬ve mora코 vzeti MNAC CP in PYP ( jih se코teje코) in iz njih izra캜una코 CLV. 캛e ima코 samo MEUR, pa rabi코 prera캜unati v MNAC in sicer tako:
+ CP ima 캜etrtletne te캜aje, PYP pa letnega, ki je povpre캜je 캜etrtletnih od prej코njega leta. iz teh izra캜una코 MNAC in potem linke, cl95, cl10, clv10. 

Potem dr쬬ve s svojo valuto, recim oDanska:
+ cel 캜as MNAC v drugi valuti. Iz nje izra캜una코 CLV in potem ga prebaci코 v MEUR. in uporabi코 xrate od leta 2010..  캛e ga izra캜una코 iz MEUR pa je tudi prav, razen za 1995. Samo ne razumem zakaj ne. 
Ampak v bistvu moram itak MNAC uporabljat, tako da je to verjetno to. 캛e je v EUR, potem bo CLV itak prav, za ostale pa rabim samo xrate iz leta 2010, kar pa je stalno, tako da ni nobenega overheada i guess. 

Grem probat 코e kako dr쬬vo. Portugalska je OK razen za 1995 in malenkost 1996 (0.27%).


Se praiv rabim xrate za 2010, ki ga dobim iz CVL meur clv mnac. Dejmo to potegnt dol najprej. 

OK, imam xrates-e v 00_geo_lookup.R.

Zdej imam 코e annual funkcijo za CLV-je. Dela super. Zdaj je vpra코anje, ali sploh downloadat CLV-je iz eurostata, 캜e jih lahko jaz izra캜unam. Ali naj jih izra캜unamo samo za agregate. No dejmo samo za agregate, da bo hitreje?

# 30.7.24

ugh. agregiranje pomeni, da je treba najprej se코tet mnac-je, in za to jih mora코 najprej konvertirat v meur. se pravi rabim xrates in za cp in za pyp. 


OK, se pravi takole mora it proces: imamo dve dimenziji agregiranja, po SKD-jih in po geografijah. Kazalnike imamo navadne, npr. PPS ali zaposlenost, in pa nenavadne, kot je CLV. Navadne se enostavno se코teva, ampak CLV-jev pa ne se코teva코. Za njih mora코 najprej se코teti MNAC vrednosti. In 캜e agregira코 geografije, jih mora코 najprej xrate-at preden jih lahko se코teva코. Potem, ko so se코teti, pa lahko izra캜una코 CLV. Za aggregate SKD je torej OK, da se enostavno se코tejejo vsi kazalniki. za aggregate geo pa je treba xrate. potem, ko je vse agregiranje narejeno pa pride chain linking. 


OK,

01: samo geo agregiranje
02: geo in skd aggregiranje
03: najprej samo geo agregiranje
    potem geo in skd 64 agregiranje
04: najprej samo geo agregiranje
    potem geo in skd 10 agregiranje

Zdej je trega narest geo_aggregiranje funkcijo, ki bo delala v vseh teh pogojih. predvsem je issue, ker imajo lahko input tabele razli캜no 코tevilo stolpcev. treba pa jo je znotraj funkcije dat wider in potem spet nazaj longer. Za longer pa rabim vedet 코tevilo stolpcev, a ne. ki je enako 코tevilu unique v unit? probam to. OK, aggregate_geo seems to work on 1, 2, 3 and 4, that means regardless of the number of columns, and regardless if MNAC is there or not. if it is, the values are converted to Euros first. 

# 31.7.24

OK, zdej mislim, da sem v R-u prav naredila za letne, ampak se ne izzide za recimo EU15 al pa EU27. Ampak nisem prav naredila a ne, ker smo rekli, da za letne ne rabim MNAC, a ni blo tko?


OK, gremo letne 코e enkrat brez MNAC. Fun. OK, dela. na grafu se ful lepo ujema za 15 in 27 total. grem 코e procente pogledat. OK, za EU27 total je najve캜ja napaka 0.59% za 95, potem pada. Za EU15 je max 0.12% leta 1995 in tudi pada pol. This is acceptable afaic. 

OK, 01 mislim, da je OK. Samo sem morala za emp in pop dodat EU27 agregiranje, ker ga na eurostatu ni, aja, ne, problem je, da ya hrva코ko ni age disagregated podatkov na pjan, tako da vse izpeljane spremenljivke, ki to uporabljajo, so 코ele od leta 2010 naprej. AMpak tako pa캜 je, ne gre druga캜e. Za dodat v dokumentacijo. 



OK, zdej dodajam SKD-je v dvojki. in se nekaj zatakne pri malti za HTM, ker ni podatkov pred letom 2017. kako je do tega pri코lo ne vem, ampak ja, 캜e ni podatkov za 2010, pol koda seveda ne more delat.. Aha, HTM sta C21 in C26, in Malta nima podatkov do leta 2017 - do takrat so faking confidential. To pa pomeni, da ne morem izra캜unat CLV-jev, 캜e nimam referen캜nega leta. Tko da jebi se Malta, leti코 ven. Upam, da je to edina taka fora... Mogo캜e 캜e probam pogruntat kaj 코e manjka? Luxemburbu tudi cel kup sektorjev manjka. Druga캜e pa 코e par malenkosti, ampak nobena taka, da bi cel agregiran sektor manjkal - to je namre캜 issue pri MT (in LU), 캜e ni niti enega pod sektorja, potem ni serije. Skratka to gre v dokumentacijo, kodo pa popravimo tako, da ne se코tevamo stvari, ki nimajo podatkov za 2010 i guess. 


# 1.8. 

Zdej sem porabla en dan za to malto in Lux jebemti. Ampak zdej dela in 캜e bo 코e komu manjkal za 2010, bo tudi delal ok. 

OK, 01 in 02 zdej delata ok.

gremo na 03, tuki je issue pri aggr in CLV, da so 코e D1 in D11 in D12 zraven, ki pa imajo samo CP vrednosti, ne pa tudi PYP oz. CLV, se pravi moram to nekako popucat...

OK, trojka dela, naredila double check in primerjala z originalom in so edine razlike na agregiranih geograpfijah na sedmih kazalnikih, ki imajo reale not. In to za vsa leta razen za 2010, juhej!

Hm, trojka VA check pa ima razlike tudi pri zaposlenosti, why the fuck. 

# 2.8.24

OK, double check po vrsti, v 01 so razlike tam, kjer jih ne bi smelo bit. step by step debugging. aha, EA20 je mel napa;no grupo, popravljeno. gremo 02 pogledat. 02 debugging tudi na코el dve napaki, ampak zdej je OK. razlike so samo na realah in iz njih izra캜unanih zadevah, na nominalah in emp spremenljivkah so e-10 razlike, kar je floating point issue, efektivno je vse perfektno.
OK, 03. Evo, dela perfektno, juhej!!! aja, to je prvi del. kaj pa drugi del? tudi OK, razlike max e-09, so all good :)

# 5.8.24

ok, naredimo 코e SURS zdej letne, 06. Aja, ne, dejmo najprej popeglat te agregacije, ker so preve캜 dolge. O, clean up 01 super, pod 150 znakov. gremo naprej. Dvojka tudi OK, pod 130 znakov. 
OK, trojka. Prvi del je OK. ampak OK, zdej pri 03 pa imamo v drugem delu A10, kar pomeni, da sektorji niso ve캜 tako simple oz. natan캜neje, da je treba C od코tet od B-E preden lahko naredimo Ostalo. Fun times. OK, zdej sem pri 3.2 morala nekaj popravljat funkcije, zato 코e enkrat preverjam 1 in 2. 

dodala 코e energetske in predelovalne brez energetskih za Rotijo. to je zdej za eurostat a64 samo. 

# 6.8.24

OK, 03.1 je ok, 03.2 tudi, s tem, da so "ostale" seveda druga캜ne, dodan je BDE in manjka EU27, se pravi vse super. 

Gremo 코e 06 za surs probat.

OK, delno ok, ampak se sesuje pri agregacijah, kjer je 2023 nula, ker backward chain ne dela.. se pravi bo treba popravit v bistvu celo funkcijo po moje. ampak jutri, ok?

# 7.8.2024

Mogo캜e pa ne rabim popravit, samo dodam exception za nulo. OK, je 코lo tako. 6.01 dela OK, preverjeno, dodala 코e vse ostale skd agregacije, ki jih imamo pri eurostatu. in v skd lookup popravila list za surs det, moram to 코e za a10 in a64 narest. in 6.2 narest in spet preverit vse letne skripte. pol pa res dost.. 

# 9.8.2024

ok, 6.2 je tudi OK. Mislim, da je koda za letne vse OK zdej. Gremo 코e enkrat 캜ez vse in sproti dokumentacijo popravimo. 
1, 2 in 31 in 32 so vsi preverjeni in dokumentacija popravljena. Samo 코e 61 in 62 in gremo na produkcijo. 













