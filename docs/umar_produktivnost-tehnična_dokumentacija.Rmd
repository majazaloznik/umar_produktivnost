---
title: "Tehnična dokumentacija za bazo `produktivnost` na PostgreSQL strežniku na `umar-bi`"
author: "mz"
date: "`r format(Sys.time(), '%d.%B %Y')`"
output:
        bookdown::pdf_document2:
                toc_depth: 4
urlcolor: blue
header-includes:
  - \renewcommand{\contentsname}{Vsebina}    
  - \usepackage{booktabs}
  - \usepackage[table]{xcolor}
  - \usepackage{float}
  - \usepackage{longtable}


---

# Pregled

Dokument vsebuje tehnično dokumentacijo glede podatkovnih tokov za zajem, obdelavo in zapis podatkov o produktivnosti v bazo `produktivnost` na PostgreSQL strežniku na `umar-bi` 

Gre za selitev podatkovnih tokov, ki so pred tem temeljili na Katarininih skriptah in se zapisovali v MS Access datoteke na M:. 

Projektna mapa se nahaja na `O:Avtomatizacija\umar_produktivnost`

# R skripte

Vse skripte se nahajajo na `O:Avtomatizacija\umar_produktivnost\R`

## `00_geo_lookup.R`

Pomožna skripta, ki pripravi 11 vektorjev za 11 agregacij držav, in tabelo `geo_lookup`, ki vsebuje po en logičen stolpec za vsako od agregacij.

*posodabljanje* - Se posodablja ročno v primeru spremeb v članstvu EU, EA ali držav, ki veljajo za *vodilne inovatorke*

## `01_produktivnost_makro.R` {#Sec:skripta1}

*originalna verzija* - `arhiv\1_Macro_PROD.R`

*output:*

+ [produktivnost_makro](#Sec:pm)


*opis*:

1. zajem podatkov iz evrostata iz tabel `nama_10_gdp` (BDP), `nama_10_a10_e` (zaposlenost),  `nama_10_pe` (prebivalstvo) in `demo_pjan` (prebivalstvo po starosti)
2. izračun agregatov za sedem skupin držav (glej poglavje \@ref(Sec:pm) za detajle) in združitev tabel
3. izračun 22 novih spremenljivk (glej poglavje \@ref(Sec:pmvs) za detajle)
4. zapis v tabelo `produktivnost_makro`

*spremembe* glede na originalno verzijo: 

+ agreggati za stalne cene so izračunani iz tekočih in cen prejšnjega leta namesto seštevanja stalnih cen
+ dodani so novi agregati za EA20
+ dodane so spremenljivke za dekompozicijo produktivnosti glede na working age population

*posodabljanje* - avtomatski zagon skripte v Task scheduler-ju na strežniku umar-bi ob 11:00:30 na dneve, ko eurostat [release calendar](https://ec.europa.eu/eurostat/news/release-calendar) pravi, da se posodabljajo "Economy and finance GDP and main aggregates/Empl."

## `02_produktivnost_strukturna.R` {#Sec:skripta2}

*originalna verzija* - `arhiv\2_Structural_PROD.R`

*output:*

+ [produktivnost_shift_share](#Sec:pss)


*opis*:

1. zajem podatkov iz evrostata iz tabel `nama_10_a64` (BDP), `nama_10_a64_e` (zaposlenost)
2. izračun agregatov za sedem skupin držav (glej poglavje \@ref(Sec:pss) za detajle) in združitev tabel
3. izračun agregatov za 14 dodatnih SKD grupacij skupin držav (glej poglavje \@ref(Sec:pss) za detajle in združitev tabel
4. izračun 20 novih spremenljivk (glej poglavje \@ref(Sec:pssvs) za detajle)
5. zapis v tabelo `produktivnost_shift_share`

*spremembe* glede na originalno verzijo. V originalni skripti so bile pripravljene 3 tabele: 

+ brez geografske in SKD agregacije tabela z dekompozicijo produktivnosti na zaposlenega
+ brez geografske in SKD agregacije tabela z dekompozicijo produktivnosti na delovne ure
+ z geografsko in in SKD agregacijo tabela samo z sektorskimi deleži in real/nom. produktivnostmi

V novi skripti so vse tri tabele združene v eni, kar pomeni, da so dekompozicije na voljo tudi za vse geografske in SKD agregacije.

+ agreggati za stalne cene so izračunani iz tekočih in cen prejšnjega leta namesto seštevanja stalnih cen
+ za comprehensiveness in konsistentnost z ostalimi tabelami so dodane naslednje spremenljivke: `VA_share_real`, `PROD_yoy_EMP`, `PROD_yoy_HW`, `STRUCT_shift_HW`, `STRUCT_shift_EMP`

*posodabljanje* - avtomatski zagon skripte v Task scheduler-ju na strežniku umar-bi ob 11:00:30 na dneve, ko eurostat [release calendar](https://ec.europa.eu/eurostat/news/release-calendar) pravi, da se posodabljajo "Economy and finance GDP and main aggregates/Empl."


## `03_RULC_letno.R` {#Sec:skripta3}

*originalna verzija* - `arhiv\3_RULC_A.R`

*outputi:*

+ [RULC_BDP_total_letni](#Sec:rulcatot)
+ [RULC_VA_NACE_letni](#Sec:rulcanace)

*opis - 1. del: totals*:

1. zajem podatkov iz evrostata iz tabel `nama_10_gdp` (BDP), `nama_10_a10_e` (zaposlenost)
2. izračun agregatov za sedem skupin držav (glej poglavje \@ref(Sec:rulcatot) za detajle) in združitev tabel
3. izračun 8 novih spremenljivk (glej poglavje \@ref(Sec:rulcatot) za detajle)
4. reorientacija v "long table"
5. izračun medletnih sprememb in indeksov za 2005, 2007, 2008 in 2019
6. zapis v tabelo `RULC_BDP_total_letni`

*spremembe -  1. del: totals* glede na originalno verzijo.

+ agreggati za stalne cene so izračunani iz tekočih in cen prejšnjega leta namesto seštevanja stalnih cen
+ dodani so novi agregati za EA20
+ dodan indeks za 2019
+ zaradi konsistentnosti z ostalimi tabelami so ohranjena "originalna"/angleška imena indikatorjev in dodan nov stolpec `Descriptor` z njihovimi opisnimi imeni
+ popravljeno je napačno imenovanje DV namesto BDP 
+ za comprehensiveness in konsistentnost z ostalimi tabelami so dodane naslednje spremenljivke: `COMP_nom_HW`, `COMP_real_HW`, `PROD_nom_HW`

*opis - 2. del: NACE*:

1. zajem podatkov iz evrostata iz tabel `nama_10_a10` (DV), `nama_10_a10_e` (zaposlenost)
2. izračun agregatov za osem skupin držav (glej poglavje \@ref(Sec:rulcanace) za detajle) in združitev tabel
3. disagregacija BCDE v BDE in izračun SKD agregatov (glej poglavje \@ref(Sec:rulcanace) za detajle) in združitev tabel
3. izračun 8 novih spremenljivk (glej poglavje \@ref(Sec:rulcanace) za detajle)
4. reorientacija v "long table"
5. izračun medletnih sprememb in indeksov za 2005, 2007, 2008 in 2019
6. zapis v tabelo `RULC_VA_NACE_letni`

*spremembe -  2. del: NACE* glede na originalno verzijo.

+ agreggati za stalne cene so izračunani iz tekočih in cen prejšnjega leta namesto seštevanja stalnih cen
+ dodani so novi agregati za EA20
+ dodan indeks za 2019
+ zaradi konsistentnosti z ostalimi tabelami so ohranjena "originalna"/angleška imena indikatorjev in dodan nov stolpec z njihovimi opisnimi imeni
+ za comprehensiveness in konsistentnost z ostalimi tabelami so dodane naslednje spremenljivke: `COMP_nom_HW`, `COMP_real_HW`, `PROD_nom_HW`

*posodabljanje* - avtomatski zagon skripte v Task scheduler-ju na strežniku umar-bi ob 11:00:30 na dneve, ko eurostat [release calendar](https://ec.europa.eu/eurostat/news/release-calendar) pravi, da se posodabljajo "Economy and finance GDP and main aggregates/Empl."


## `04_RULC_četrtletno.R` {#Sec:skripta4}

*originalna verzija* - `arhiv\4_RULC_Q.R`

*outputi:*

+ [RULC_BDP_total_cetrtletni](#Sec:rulcqtot)
+ [RULC_VA_NACE_cetrtletni](#Sec:rulcqnace)

*opis - 1. del: totals*:

1. zajem podatkov iz evrostata iz tabel `namq_10_gdp` (BDP), `namq_10_a10_e` (zaposlenost)
2. izračun agregatov za sedem skupin držav (glej poglavje \@ref(Sec:rulcqtot) za detajle) in združitev tabel
3. izračun 8 novih spremenljivk (glej poglavje \@ref(Sec:rulcqtot) za detajle)
4. reorientacija v "long table"
5. izračun medletnih sprememb in indeksov za 2005, 2007, 2008 in 2019
6. zapis v tabelo `RULC_BDP_total_cetrtletni`

*spremembe -  1. del: totals* glede na originalno verzijo.

+ agreggati za stalne cene so izračunani iz tekočih in cen prejšnjega leta namesto seštevanja stalnih cen
+ geo agregati so samo popolni - če manjkajo podatki za katero od držav, potem tudi agregata ni za tisto obdobje.
+ dodan indeks in njegova zglajena verzija še za 2019
+ zaradi konsistentnosti z ostalimi tabelami so ohranjena "originalna" imena indikatorjev in dodan nov stolpec z njihovimi opisnimi imeni
+ za comprehensiveness in konsistentnost z ostalimi tabelami so dodane naslednje spremenljivke: `COMP_nom_HW`, `COMP_real_HW`, `PROD_nom_HW`
+ popravljeno je tudi napačno imenovanje DV namesto BDP 

*opis - 2. del: NACE*:

1. zajem podatkov iz evrostata iz tabel `namq_10_a10` (DV), `namq_10_a10_e` (zaposlenost)
2. izračun agregatov za sedem skupin držav (glej poglavje \@ref(Sec:rulcqnace) za detajle) in združitev tabel
3. izračun 8 novih spremenljivk (glej poglavje \@ref(Sec:rulcqnace) za detajle)
4. reorientacija v "long table"
5. izračun medletnih sprememb in indeksov za 2005, 2007, 2008 in 2019
6. zapis v tabelo `RULC_VA_total_cetrtletni`

*spremembe -  2. del: NACE* glede na originalno verzijo.

+ agreggati za stalne cene so izračunani iz tekočih in cen prejšnjega leta namesto seštevanja stalnih cen
+ geo agregati so samo popolni - če manjkajo podatki za katero od držav, potem tudi agregata ni za tisto obdobje.
+ dodani so novi agregati za in EA20
+ dodan indeks in njegova zglajena verzija še za 2019
+ zaradi konsistentnosti z ostalimi tabelami so ohranjena "originalna"/angleška imena indikatorjev in dodan nov stolpec z njihovimi opisnimi imeni
+ za comprehensiveness in konsistentnost z ostalimi tabelami so dodane naslednje spremenljivke: `COMP_nom_HW`, `COMP_real_HW`, `PROD_nom_HW`

*posodabljanje* - avtomatski zagon skripte v Task scheduler-ju na strežniku umar-bi ob 11:00:30 na dneve, ko eurostat [release calendar](https://ec.europa.eu/eurostat/news/release-calendar) pravi, da se posodabljajo "Economy and finance GDP and main aggregates/Empl."



## `05_SURS_RULC_strukt_četrtletno.R` {#Sec:skripta5}

*originalna verzija* - cca prvi del `arhiv\3_4_SURS_prod.R` 

*outputi:*

+ [SURS_shift_share_cetrtletni](#Sec:sursssq)
+ [SURS_RULC_VA_SKD_cetrtletni](#Sec:sursrulcskdq)
+ [SURS_RULC_BDP_total_cetrtletni](#Sec:sursrucltotq)

*opis*:

1. zajem podatkov iz SiStata iz tabel `0300220S.px` (DV), `0300260S.px` (zaposlenost) in `0300240S.px` (stroški dela)
2. izračun agregatov za (ne)menjalne in (ne)poslovne idr. sektorje in za BDE in združitev tabel
3. izračun 23 novih spremenljivk za shift share analizo (glej poglavje \@ref(Sec:sursssvs) za detajle)
4  zapis v tabelo `SURS_shift_share_cetrtletni`
5. Izračun 11 novih spremenljivk za RULC (glej poglavje \@ref(Sec:sursrulcskdq) za detajle)
6. reorientacija v "long table"
7. Izračun medletnih sprememb in indeksov za 2005, 2007, 2008 in 2019
8. zapis v tabelo `SURS_RULC_VA_SKD_cetrtletni`
9. Izračun 11 novih spremenljivk za RULC total (glej poglavje \@ref(Sec:sursrucltotq) za detajle)
10. reorientacija v "long table"
11. Izračun medletnih sprememb in indeksov za 2005, 2007, 2008 in 2019
12. zapis v tabelo `SURS_RULC_BDP_total_cetrtletni `


*spremembe * glede na originalno verzijo.

+ agreggati za stalne cene so izračunani iz tekočih in cen prejšnjega leta namesto seštevanja stalnih cen
+ originalna skripta je po novem ločena na dva dela: tale za četrtletne podatke in `06_SURS_RULC_strukt_letno.R` za letne podatke
+ prejšnja tabela TOT_PROD_q ne obstaja več, ker so vsi podatki (samo v dolgi obliki) na voljo v tabeli `SURS_RULC_BDP_total_cetrtletni`
+ prejšnja tabela `RULC_A_q` tudi ne obstaja več, ker za njo ni bilo kode (?), ampak tudi, ker v Access bazi izgleda identična kot `RULC_q`, kar je po novem `SURS_RULC_VA_SKD_cetrtletni`
+ pri obeh RULC tabelah je dodan indeks in njegova zglajena verzija še za 2019
+ pri obeh RULC tabelah so zaradi konsistentnosti z ostalimi tabelami ohranjena "originalna" imena indikatorjev in dodan nov stolpec z njihovimi opisnimi imeni
+ za comprehensiveness in konsistentnost z ostalimi tabelami je shif share tabeli dodan agregat za SKD skupino `BDE`, ter naslednje spremenljivke:  `VA_share_real`, `EMP_share_diff`, `HW_share_diff`, `PROD_diff_EMP`, `PROD_diff_HW`, `STRUCT_shift_EMP`, `STRUCT_shift_HW`
+ za comprehensiveness in konsistentnost z ostalimi tabelami so RULC tabelam dodane naslednje spremenljivke: `COMP_real_EMP`, `COMP_real_HW`, `deflator_GDP` oz. `deflator_VA`

*posodabljanje* - avtomatski zagon skripte v Task scheduler-ju na strežniku umar-bi vsak dan ob 10:30:30

## `06_SURS_RULC_strukt_letno.R` {#Sec:skripta6} 

*originalna verzija* - cca drugi del `arhiv\3_4_SURS_prod.R` 

*outputi:*

+ [SURS_shift_share_letni](#Sec:sursssa)
+ [SURS_RULC_VA_SKD_letni](#Sec:sursrulcskda)
+ [SURS_RULC_BDP_total_letni](#Sec:sursrucltota)

*opis*:

1. zajem podatkov iz SiStata iz tabel `0301915S.px` (DV), `0301975S.px` (zaposlenost), `0301930S.px` (stroški dela), `0301910S.px`(BDP) in `0301925S.px` (stroški dela skupno)
2. agregiranje v 14 novih SKD agregatov
2. izračun 23 novih spremenljivk za shift share analizo (glej poglavje \@ref(Sec:sursssvsa) za detajle)
3.  zapis v tabelo `SURS_shift_share_letni`
4. Izračun 11 novih spremenljivk za RULC (glej poglavje \@ref(Sec:sursrulcskda) za detajle)
5. reorientacija v "long table"
6. Izračun medletnih sprememb in indeksov za 2005, 2007, 2008 in 2019
7. zapis v tabelo `SURS_RULC_VA_SKD_letni`
8. Izračun 11 novih spremenljivk za RULC total (glej poglavje \@ref(Sec:sursrucltota) za detajle)
9. reorientacija v "long table"
10. Izračun medletnih sprememb in indeksov za 2005, 2007, 2008 in 2019
11. zapis v tabelo `SURS_RULC_BDP_total_letni `


*spremembe * glede na originalno verzijo.

+ originalna skripta je po novem ločena na dva dela: tale za letne podatke in `05_SURS_RULC_strukt_cetrtletno.R` za četrtletne podatke
+ agreggati za stalne cene so izračunani iz tekočih in cen prejšnjega leta namesto seštevanja stalnih cen
+ originalna shift share tabela je imela zbrisane SKD kategorije na 1. ravni za katere so podatki tudi na 2. ravni, poleg tega je bila vsota za vse skupaj sešteta (in torej narobe za reale). V tej verziji so vse SKD kategorije ohranjene, ravno tako od SURS-a objavljene vrednosti za vse skupaj (namesto našega preračunavanja). 
+ dodana sta tudi ločena stolpca za SKD kodo in stopnjo agregacije. 
+ dodane so tudi agregacije (ne)menjalni, (ne)poslovni itd. 
+ za comprehensiveness in konsistentnost z ostalimi tabelami so shif share tabeli dodane naslednje spremenljivke:  `VA_share_real`, `EMP_share_diff`, `HW_share_diff`, `PROD_diff_EMP`, `PROD_diff_HW`, `STRUCT_shift_EMP`, `STRUCT_shift_HW`
+ originalni RULC tabeli sta imeli indekse za 2000 in 2005, po novem imamo 2005, 2007, 2008 in 2019
+ pri obeh RULC tabelah so zaradi konsistentnosti z ostalimi tabelami ohranjena "originalna" imena indikatorjev in dodan nov stolpec z njihovimi opisnimi imeni
+ originalna RULC SKD tabela je imela samo SKD-je na 1.ravni in agregirane, zdaj so dodane še 2. ravni in spremenjlivka `aggr`, za lažje ločevanje med njimi. 
+ za comprehensiveness in konsistentnost z ostalimi tabelami so RULC tabelam dodane naslednje spremenljivke: `COMP_real_EMP`, `COMP_real_HW`, `deflator_GDP` oz. `deflator_VA`

*posodabljanje* - avtomatski zagon skripte v Task scheduler-ju na strežniku umar-bi vsak dan ob 10:30:30




\newpage
# Baza `produktivnost` - tabele

## Tabela `geo_lookup` {#Tbl:gl}

Pomožna tabela z:

+ 28 vrsticami, ena za vsako od 28 držav (`geo`)  - unique constrant 

### Spremenljivke 

11 logičnih stolpci - ena za vsako od možnih agregacij: 

\begin{table}[H]
\scriptsize
\centering
\begin{tabular}{ll}
\toprule
\textbf{Oznaka} & \textbf{Opis}\\
\midrule
EU28  & EU do Brexita      \\
EU15  &    stare EU članice pred Brexitom   \\
EA20  & območje Evra po pristopu Hrvaške     \\
EA19   & območje Evra pred pristopom Hrvaške     \\
EU27  & EU članice po Brexitu  \\
EU13    & nove EU članice po 2004   \\
EU14      & stare EU članice po Brexitu    \\
EU27\_noIE& EU članice po Brexitu  brez Irske \\
EA\_noIE & Evro območje brez Irske (po pristopu Hrvaške)\\
inovatorke & vodilne inovatorke (trenutno DK, SE, FI in NL) \\
V4 & Višegrajske 4 (CZ, HU, SK, PL) \\
\bottomrule
\end{tabular}
\caption{Spremenljivke v tabeli `geo\_lookup`}
\label{tab:geo_lookup}
\end{table}


## Tabela `produktivnost_makro` {#Sec:pm}

*Skripta*: [01_produktivnost_makro.R](#Sec:skripta1) (poglavje \@ref(Sec:skripta1))

*Prejšnja lokacija tabele*: `podatki_PROD_makro.accdb` tabela `Produktivnost_makro`

**geo**: 

* 28 držav članic
* štirje originalni agregati iz Eurostata 
* sedem dodatnih agregatov, izračunanih iz podatkov posameznih držav. Agregati za stalne cene 2010 so preračunani iz tekočih cen in cen prejšnjega leta, da se zagotovi seštevnost. 

\begin{table}[H]
\scriptsize
\centering
\begin{tabular}{ll}
\toprule
\textbf{Oznaka} & \textbf{Opis}  \\
\midrule
SI, AT... & 28 EU držav (vključno z UK) - uporabljene so dvomestne ISO oznake \\
\midrule
EU28 & EU do Brexita (samo do leta 2019) \\
EU15 & stare EU članice pred Brexitom (samo do leta 2019) \\
EA19& območje Evra pred pristopom Hrvaške \\ 
EU27\_2020 & EU članice po Brexitu \\
\midrule
EU13& nove EU članice po 2004  \\ 
EU14& stare EU članice po Brexitu \\
EU27noIE & EU članice po Brexitu  brez Irske \\
EA20 & območje Evra po pristopu Hrvaške   \\
EAnoIE & Evro območje brez Irske (po pristopu Hrvaške) \\
inovatorke & vodilne inovatorke - trenutno DK, SE, FI in NL\\
V4 & Višegrajske 4:CZ, HU, SK, PL \\
\bottomrule
\end{tabular}
\caption{Vrednosti v stolpcu geo}
\label{tab:geo_summary}
\end{table}

**agr**:

* logična spremenljivka, ki odraža ali gre za eno od ne-agregiranih geografij (torej eno od 28 držav) ali katero od dvanajstih agregacij, v katerem primeru ima vrednost TRUE.
* če hočeš samo podatke o državah, brez agregacij, filtriraš na `agr == FALSE` oz. `0`.

**time**: Letnica

### Vsebinske spremenljivke {#Sec:pmvs}

v spodnji tabeli so razdeljene v tri skupine:

+ originalne spremenljivke, nesprememnjene iz eurostata (v zadnjem stolpcu je ime izvorne tabele)
+ preračunane spremenljivke (v zadnjem stolpcu je nakazan preračun glede na zaporedne številke spremenljivk)
+ preračunani indeksi za EU27 = 100

\begin{table}[H]
\scriptsize
\centering
\begin{tabular}{clll}
\toprule
\textbf{\#} & \textbf{Oznaka} & \textbf{Opis} & \textbf{Vir / Preračun} \\
\midrule
(1) & CP\_MPPS\_EU27\_2020\_B1GQ & BDP, tekoče cene, v mio SKM (EU27 od 2020) & nama\_10\_gdp \\
(2) & CLV10\_MEUR\_B1GQ & BDP, stalne cene leta 2010, v mio EUR & nama\_10\_gdp \footnotemark \\
(3) & THS\_PER\_EMP\_DC & Skupna zaposlenost, domači koncept, v 1000 oseb & nama\_10\_a10\_e \\
(4) & THS\_HW\_EMP\_DC & Delovne ure, domači koncept, v 1000 & nama\_10\_a10\_e \\
(5) & THS\_PER\_POP\_NC & Št. Prebivalcev, nacionalni koncept, v 1000 & nama\_10\_pe \\
(6) & NR\_20\_64 & Št. običajnih prebivalcev starosti 20-64 let, v 1000 & demo\_pjan \\
(7) & NR\_TOTAL & Št. običajnih prebivalcev, v 1000 & demo\_pjan \\
\midrule
(8) & GDP\_PC\_PPS & BDP na prebivalca v SKM & (1) / (5) \\
\textcolor{gray!50}{(9)} & \textcolor{gray!50}{GDP\_PC\_PPS\_pjan} & \textcolor{gray!50}{BDP na običajnega prebivalca v SKM} & \textcolor{gray!50}{(1) / (7)} \\
(10) & PROD\_PPS & Produktivnost v SKM, na zaposlenega & (1) / (3) \\
(11) & PROD\_PPS\_HW & Produktivnost v SKM, na delovno uro & (1) / (4) \\
(12) & PROD\_real & Realna produktivnost, na zaposlenega & (2) / (3) \\
(13) & PROD\_real\_HW & Realna produktivnost, na delovno uro & (2) / (4) \\
(14) & EMP\_RATE & Delež zaposlenih v celotnem prebivalstvu & (3) / (5) \\
(15) & HW\_EMP & Delovne ure na zaposlenega & (4) / (3) \\
(16) & EMP\_W\_AGE\_PROP & Delež zaposlenih v preb (20-64) & (3) / (6) \\
  \textcolor{gray!50}{(17)} & \textcolor{gray!50}{W\_AGE\_PROP} & \textcolor{gray!50}{Delež preb 20-64 v skupnem prebivalstvu} & \textcolor{gray!50}{(6) / (5)} \\
(18) & W\_AGE\_PROP\_pjan & Delež preb 20-64 v skupnem prebivalstvu & (6) / (7) \\
\midrule
(19) & GDP\_PC\_PPS\_EU27\_100 & \multicolumn{2}{l}{BDP pc v SKM (indeks EU27\_2020 = 100) } \\
\textcolor{gray!50}{(20)} & \textcolor{gray!50}{GDP\_PC\_PPS\_pjan\_EU27\_100} & \multicolumn{2}{l}{\textcolor{gray!50}{BDP pc v SKM (indeks EU27\_2020 = 100)} } \\
(21) & PROD\_PPS\_EU27\_100 & \multicolumn{2}{l}{Produktivnost v SKM (indeks EU27\_2020 = 100), na zaposlenega } \\
(22) & PROD\_PPS\_EU27\_100\_HW & \multicolumn{2}{l}{Produktivnost v SKM (indeks EU27\_2020 = 100), na delovno uro } \\
(23) & EMP\_RATE\_EU27\_100 & \multicolumn{2}{l}{Stopnja zaposlenosti (indeks EU27\_2020 = 100) } \\
(24) & HW\_EMP\_EU27\_100 & \multicolumn{2}{l}{Delovne ure na zap. (indeks EU27\_2020 = 100) } \\
(25) & EMP\_W\_AGE\_PROP\_EU27\_100 & \multicolumn{2}{l}{Delež zaposlenih v preb (20-64) (indeks EU27\_2020 = 100) } \\
\textcolor{gray!50}{(26)} & \textcolor{gray!50}{W\_AGE\_PROP\_EU27\_100} & \multicolumn{2}{l}{\textcolor{gray!50}{Delež preb 20-64 v skupnem prebivalstvu (indeks EU27\_2020 = 100) }} \\
(27) & W\_AGE\_PROP\_pjan\_EU27\_100 & \multicolumn{2}{l}{Delež preb 20-64 v skupnem prebivalstvu (indeks EU27\_2020 = 100) } \\
\bottomrule
\end{tabular}
\caption{Spremenljivke v tabeli `produktivnost\_makro`}
\label{tab:eurostat_summary}
\end{table}
\footnotetext[1]{V primeru geografskih agregatov so vredosti CLV10\_MEUR izračunane iz CP in PYP vrednosti objavljenih v isti tabeli.}

Posebna pozornost je potrebna glede naslednjih parov spremenljivk 

* BDP na prebivalca: spremenljivki 8 in 9 (oz. 19 in 20 za indekse): prva uporablja prebivalstvo po nacionalnem konceptu in je tako *pravilna*, druga uporablja vsoto "običajnih prebivalcev" je v tabeli dodana samo za primerjavo
* Delež prebivalcev 20-64 v skupnem prebivalstvu: spremenljivki 17 in 18 (oz. 26 in 27): tukaj je *pravilna* druga spremenljivka, kjer sta v imenovalcu in števcu števili običajnih prebivalcev (iz tabele `pjan`), medtem ko je v prvi definicija prebivalstva v imenovalniku po nacionalnem konceptu, kar ni OK, ampak je dodana samo za primerjavo. 


## Tabela `produktivnost_shift_share` {#Sec:pss}

*Skripta*: \hyperref[Sec:skripta2]{02\_produktivnost\_strukturna.R} (poglavje \@ref(Sec:skripta2))

*Prejšnja lokacija tabel*: `Shift_share(PROD).accdb` tabele `Aggregates`, `Shift_share` in `Shift_share_HW` - ki so zdaj vse združene v eni tabeli

**`nace_r2`** so SKD kode in **`nace_descr`** in **`nace_level`** so SKD klasifikacije na treh ravneh (glej tabelo \ref{tbl:nace}):

* `level_1` so črkovne SKD oznake, teh je (vseh) 21
* `level_2` so SKD oznake na drugi ravni - vendar niso kompletne oz. so kompletne skupaj z ustreznimi agregati,
* `aggr` so agregirane oznake, kar lahko pomeni agregiranje na drugi ravni (e.g. `C16-C18`), na prvi ravni (e.g. `G-I`) in seveda vse  skupaj (`TOTAL`)

*Poleg 91 originalnih klasifikacij, je dodanih še 14 naših (glej tabelo \ref{tbl:umar}).*


```{r 2table, echo=FALSE, results='asis', warning = FALSE, message = FALSE}
suppressPackageStartupMessages(library(kableExtra))
nace_codes <- readRDS("../data/nace_codes.rds")
umar_codes <- nace_codes[92:105,]
kable(umar_codes, "latex", longtable = FALSE, caption = "SKD šifrant dodatne agregacije Umar\\label{tbl:umar}",  row.names = FALSE, booktabs = TRUE,  placement = "H")  |> 
  kable_styling(latex_options = c("repeat_header")) |> 
  column_spec(1, width = "5cm") |> 
  column_spec(2, width = "1.5cm") |> 
  column_spec(3, width = "7cm")  

```

```{r longtable, echo=FALSE, results='asis', warning = FALSE, message = FALSE}

kable(nace_codes[1:91,], "latex", longtable = TRUE, caption = "SKD šifrant NACE A*64\\label{tbl:nace}", row.names = FALSE, booktabs = TRUE,  placement = "H")  |> 
  kable_styling(latex_options = c("repeat_header")) |> 
  column_spec(1, width = "1.5cm") |> 
  column_spec(2, width = "1.5cm") |> 
  column_spec(3, width = "12cm")  
```


**geo** 

* 28 držav članic
* štirje originalni agregati iz Eurostata 
* sedem dodatnih agregatov, izračunanih iz podatkov posameznih držav.


\begin{table}[H]
\scriptsize
\centering
\begin{tabular}{ll}
\toprule
\textbf{Oznaka} & \textbf{Opis}  \\
\midrule
SI, AT... & 28 EU držav (vključno z UK) - uporabljene so dvomestne ISO oznake \\
\midrule
EU28 & EU do Brexita (samo do leta 2019) \\
EU15 & stare EU članice pred Brexitom (samo do leta 2019) \\
EA19& območje Evra pred pristopom Hrvaške \\ 
EU27\_2020 & EU članice po Brexitu \\
\midrule
EU13& nove EU članice po 2004  \\ 
EU14& stare EU članice po Brexitu \\
EU27noIE & EU članice po Brexitu  brez Irske \\
EA20 & območje Evra po pristopu Hrvaške   \\
EAnoIE & Evro območje brez Irske (po pristopu Hrvaške) \\
inovatorke & vodilne inovatorke - trenutno DK, SE, FI in NL\\
V4 & Višegrajske 4:CZ, HU, SK, PL \\
\bottomrule
\end{tabular}
\caption{Vrednosti v stolpcu geo}
\label{tab:geo_summary2}
\end{table}

**agr**:

* logična spremenljivka, ki odraža ali gre za eno od ne-agregiranih geografij (torej eno od 28 držav) ali katero od dvanajstih agregacij, v katerem primeru ima vrednost TRUE.
* če hočeš samo podatke o državah, brez agregacij, filtriraš na `agr == FALSE`

**time** - Letnica 

### Vsebinske sprememnljivke  {#Sec:pssvs}

\begin{table}[H]
\scriptsize
\centering
\begin{tabular}{clll}
\toprule
\textbf{\#} & \textbf{Oznaka} & \textbf{Opis} & \textbf{Vir / Preračun} \\
\midrule
(1) & VA\_nom & Dodana vrednost, tekoče cene, v mio EUR& nama\_10\_a64 \\
(2) & VA\_share\_nom & delež nom. dodane vrednosti v sektorju & (1) / $\Sigma$(1)\\
(3) & VA\_real & Dodana vrednost, stalne cene (2010), v mio EUR & nama\_10\_a64 \footnotemark \\
(4) & VA\_share\_real & delež real. dodane vrednosti v sektorju & (3) / $\Sigma$(3)\\
(5) & THS\_HW & Delovne ure, domači koncept, v 1000 & nama\_10\_a64\_e \\
(6) & THS\_PER & Zaposlenost, domači koncept, v 1000 & nama\_10\_a64\_e \\
\midrule
(7) & EMP\_share & delež zaposlenih v sektorju & (6) / $\Sigma$(6) \\
(8) & PROD\_real\_EMP & realna produktivnost na zaposlenega & (3) / (6) \\
(9) & PROD\_nom\_EMP & nominalna produktivnost na zaposlenega & (1) / (6) \\
(10) & PROD\_diff\_EMP & sprememba realne produktivnosti na zaposlenega & (8) - $(8)_{t-1}$ \\
(11) & PROD\_yoy\_EMP & medletna rast realne produktivnosti na zaposlenega & ((8) / $(8)_{t-1}$ -100) *100  \\
(12) & EMP\_share\_diff & sprememba deleža zaposlenih v sektorju & (6) - $(6)_{t-1}$ \\
(13) & WITHIN\_effect\_EMP & znotrajsektorska rast produktivnosti na zaposlenega & (10) $\times (7)_{t-1}$ \\
(14) & STATIC\_shift\_EMP & statični strukturni učinek rasti produktivnosti na zaposlenega & (12) $\times (8)_{t-1}$ \\
(15) & DYNAMIC\_shift\_EMP & dinamični strukturni učinek rasti produktivnosti na zaposlenega & (12) $\times$ (10) \\
(16) & STRUCT\_shift\_EMP & dinamični strukturni učinek rasti produktivnosti na zaposlenega & (14) + (15)\\
\midrule
(17) & HW\_share & delež delovnih ur v sektorju & (5) / $\Sigma$(5)\\
(18) & PROD\_real\_HW & realna produktivnost na delovno uro & (3) / (5) \\
(19) & PROD\_nom\_HW & nominalna produktivnost na delovno uro & (1) / (5) \\
(20) & PROD\_diff\_HW & sprememba realne produktivnosti na delovno uro & (18) - $(18)_{t-1}$ \\
(21) & PROD\_yoy\_HW & medletna rast realne produktivnosti na delovno uro &  ((18) / $(18)_{t-1}$ -100) *100  \\
(22) & HW\_share\_diff & sprememba deleža deleža delovnih ur v sektorju & (17) - $(17)_{t-1}$ \\
(23) & WITHIN\_effect\_HW & znotrajsektorska rast produktivnosti na delovno uro & (20) $\times (17)_{t-1}$ \\
(24) & STATIC\_shift\_HW & statični strukturni učinek rasti produktivnosti na delovno uro & (22) $\times (18)_{t-1}$ \\
(25) & DYNAMIC\_shift\_HW & dinamični strukturni učinek rasti produktivnosti na delovno uro & (22) $\times$ (20) \\
(26) & STRUCT\_shift\_HW & dinamični strukturni učinek rasti produktivnosti na delovno uro & (24) + (25)\\
\bottomrule
\end{tabular}
\caption{Spremenljivke v tabeli \texttt{produktivnost\_shift\_share}}
\end{table}
\footnotetext[2]{V primeru geografskih in SKD agregatov in so stalne cene za dodano vrednost izračunane in CP in PYP vrednosti objavljenih v isti tabeli.}

## Tabela `RULC_BDP_total_letni` {#Sec:rulcatot}

*Skripta*: [03_RULC_letno.R](#Sec:skripta3) (poglavje \@ref(Sec:skripta3))

*Prejšnja lokacija tabele*: `RULC_letni.accdb` tabela `Total`


**geo**: 

* 28 držav članic
* štirje originalni agregati iz Eurostata 
* sedem dodatnih agregatov, izračunanih iz podatkov posameznih držav: 

\begin{table}[H]
\scriptsize
\centering
\begin{tabular}{ll}
\toprule
\textbf{Oznaka} & \textbf{Opis}  \\
\midrule
SI, AT... & 28 EU držav (vključno z UK) - uporabljene so dvomestne ISO oznake \\
\midrule
EU28 & EU do Brexita (samo do leta 2019) \\
EU15 & stare EU članice pred Brexitom (samo do leta 2019) \\
EA19& območje Evra pred pristopom Hrvaške \\ 
EU27\_2020 & EU članice po Brexitu \\
\midrule
EU13& nove EU članice po 2004  \\ 
EU14& stare EU članice po Brexitu \\
EU27noIE & EU članice po Brexitu  brez Irske \\
EA20 & območje Evra po pristopu Hrvaške   \\
EAnoIE & Evro območje brez Irske (po pristopu Hrvaške) \\
inovatorke & vodilne inovatorke - trenutno DK, SE, FI in NL\\
V4 & Višegrajske 4:CZ, HU, SK, PL \\
\bottomrule
\end{tabular}
\caption{Vrednosti v stolpcu geo}
\end{table}


**time** Letnica

**Indicator** & **Descriptor**

V spodnji tabeli so prikazane vrednosti spremenljivk Indicator in Descriptor v tabeli, v zadnjem stolpcu pa tudi vir za vsako oz. preračun. 

\begin{table}[H]
\scriptsize
\centering
\begin{tabular}{clll}
\toprule
\textbf{\#} & \textbf{Indicator} & \textbf{Descriptor} & \textbf{Vir / Preračun} \\
\midrule
 (1) & GDP\_nom & BDP tekoče cene & nama\_10\_gdp\\
 (2) & GDP\_real & BDP stalne cene 2010 & nama\_10\_gdp \footnotemark \\
 (3) & COMP\_nom & sredstva za zaposlene & nama\_10\_gdp\\
 (4) & COMP\_SAL\_nom & plače & nama\_10\_gdp\\
 (5) & COMP\_CONTR\_nom & socialni prispevki & nama\_10\_gdp\\
 (6) & THS\_HW\_EMP\_DC & zaposlenost - delovne ure (1000) & nama\_10\_a10\_e\\
 (7) & THS\_HW\_SAL\_DC & zaposleni - delovne ure (1000)& nama\_10\_a10\_e\\
 (8) &  THS\_HW\_SELF\_DC & samozaposleni - delovne ure (1000)& nama\_10\_a10\_e\\
 (9) &  THS\_PER\_EMP\_DC & zaposlenost (1000)& nama\_10\_a10\_e\\
 (10) & THS\_PER\_SAL\_DC & zaposleni (1000)& nama\_10\_a10\_e\\
 (11) & THS\_PER\_SELF\_DC & samozaposleni (1000)& nama\_10\_a10\_e\\
 \midrule
 (12) & deflator\_GDP & deflator BDP & (1) / (2)\\
 (13) & COMP\_nom\_EMP & sredstva na 1000 zaposlenih - nom. & (1) / (10)\\
 (14) & COMP\_real\_EMP & sredstva na 1000 zaposlenih - real.& (1) / (10) / (12)\\
 (15) & COMP\_nom\_HW & sredstva na 1000 delovnih ur - nom. & (1) / (10)\\
 (16) & COMP\_real\_HW & sredstva na 1000 delovnih ur - real.& (1) / (10) / (12)\\
 (17) &  PROD\_nom\_EMP & produktivnost & (1) / (9) \\
 (18) &  PROD\_real\_EMP & realna produktivnost & (2) / (9)\\
 (19) &  PROD\_nom\_HW & produktivnost na delovno uro & (2) / (6)\\
 (20) &  PROD\_real\_HW & realna produktivnost na delovno uro & (2) / (6)\\
 (21) &  RULC & Real unit labour cost & (13) / (17)\\
 (22) &   NULC & Nominal unit labour cost & (13) / (18)\\
\bottomrule
\end{tabular}
\caption{Vrednosti spremenljivk Indicator in Descriptor v tabeli \texttt{RULC\_BDP\_total\_letni}}
\end{table}
\footnotetext[3]{V primeru geografskih agregatov in so stalne cene za BDP izračunane in CP in PYP vrednosti objavljenih v isti tabeli.}

**Value** - ker gre za dolgo tabelo, so vse vrednosti v stolpcu `Value`, spremenljivka pa je identificirana v stolpcih `Indicator` oz. `Descriptor`

**YOY, Indeks2005, Indeks2007, Indeks2008** za vsako vrednost je izračunana medletna sprememba, ter štirje indeksi z baznimi leti 2005, 2007, 2008 in 2019.

## Tabela `RULC_VA_NACE_letni` {#Sec:rulcanace}

*Skripta*: [03_RULC_letno.R](#Sec:skripta3) (poglavje \@ref(Sec:skripta3))

*Prejšnja lokacija tabele*: `RULC_letni.accdb` tabela `RULC_NACE`

**nace_r2**: Poleg originalnih 12 NACE klasifikacij, je dodanih še šest naših:

\begin{table}[H]
\scriptsize
\centering
\begin{tabular}{ll}
\toprule
\textbf{nace\_r2} & \textbf{opis}  \\
\midrule                                                        
TOTAL             & Total - all NACE activities         \\                                
A                 & Agriculture, forestry and fishing     \\                            
B-E               & Industry (except construction)          \\                          
C                 & Manufacturing                             \\                        
F                 & Construction                                \\                      
G-I               & Wholesale and retail trade, transport, accommodation and food ser...\\
J                 & Information and communication                                     \\
K                 & Financial and insurance activities                                \\
L                 & Real estate activities                                            \\
M\_N              & Professional, scientific and technical activities; administrative...\\
O-Q               & Public administration, defence, education, human health and socia...\\
R-U               & Arts, entertainment and recreation; other service activities; act...\\
\midrule                                                        
Menjalni   & A, B-E, G-I, J                                                    \\
Nemenjalni & F, K, L, M\_N, O-Q, R-U                                            \\
Poslovni   & B-E, F, G-I, J, K, M\_N                                            \\
Neposlovni & A, L, O-Q, R-U                                                    \\
Tržni              & G-I, J, K, L, M\_N                                                 \\
Ostali             & A, BDE, O-Q, R-U \\
\bottomrule
\end{tabular}
\caption{Vrednosti spremenljivk SKD in DEJAVNOST v tabeli \texttt{SURS\_shift\_share\_cetrtletni}}
\label{tab:nace1}
\end{table}

**geo**: 

* 28 držav članic
* štirje originalni agregati iz Eurostata 
* sedem dodatnih agregatov, izračunanih iz podatkov posameznih držav:

\begin{table}[H]
\scriptsize
\centering
\begin{tabular}{ll}
\toprule
\textbf{Oznaka} & \textbf{Opis}  \\
\midrule
SI, AT... & 28 EU držav (vključno z UK) - uporabljene so dvomestne ISO oznake \\
\midrule
EU28 & EU do Brexita (samo do leta 2019) \\
EU15 & stare EU članice pred Brexitom (samo do leta 2019) \\
EA19& območje Evra pred pristopom Hrvaške \\ 
EU27\_2020 & EU članice po Brexitu \\
\midrule
EU13& nove EU članice po 2004  \\ 
EU14& stare EU članice po Brexitu \\
EU27noIE & EU članice po Brexitu  brez Irske \\
EA20 & območje Evra po pristopu Hrvaške   \\
EAnoIE & Evro območje brez Irske (po pristopu Hrvaške) \\
inovatorke & vodilne inovatorke - trenutno DK, SE, FI in NL\\
V4 & Višegrajske 4:CZ, HU, SK, PL \\
\bottomrule
\end{tabular}
\caption{Vrednosti v stolpcu geo}
\end{table}


**time** Letnica

**Indicator** & **Descriptor**

Spodaj so prikazane možne vrednosti spremenljivk Indicator in Descriptor v tabeli, v zadnjem stolpcu pa tudi vir za vsako oz. preračun. 

\begin{table}[H]
\scriptsize
\centering
\begin{tabular}{clll}
\toprule
\textbf{\#} & \textbf{Indicator} & \textbf{Descriptor} & \textbf{Vir / Preračun} \\
\midrule
(1) & VA\_nom & DV tekoče cene & nama\_10\_a10\\
 (2) & VA\_real & DV stalne cene 2010 & nama\_10\_a10 \footnotemark \\
 (3) & COMP\_nom & sredstva za zaposlene & nama\_10\_a10\\
 (4) &THS\_HW\_EMP\_DC & zaposlenost - delovne ure & nama\_10\_a10\_e\\
 (5) & THS\_HW\_SAL\_DC & zaposleni - delovne ure & nama\_10\_a10\_e\\
 (6) &  THS\_PER\_EMP\_DC & zaposlenost & nama\_10\_a10\_e\\
 (7) & THS\_PER\_SAL\_DC & zaposleni & nama\_10\_a10\_e\\
 \midrule
 (8) & deflator\_VA & deflator DV & (1) / (2)\\
 (9) & COMP\_nom\_EMP & sredstva na 1000 zaposlenih - nom.  & (1) / (5)\\
 (10) & COMP\_real\_EMP & sredstva na 1000 zaposlenih - real.& (1) / (5) / (8)\\
  (11) & COMP\_nom\_HW & sredstva na 1000 delovnih ur - nom. & (1) / (5)\\
 (12) & COMP\_real\_HW & sredstva na 1000 delovnih ur - nom.& (1) / (5) / (8)\\
 (13) &  PROD\_nom\_EMP & produktivnost & (1) / (6) \\
 (14) &  PROD\_real\_EMP & realna produktivnost & (2) / (6)\\
 (15) &  PROD\_real\_HW & realna produktivnost na delovno uro & (2) / (4)\\
 (16) &  PROD\_nom\_HW & realna produktivnost na delovno uro & (2) / (4)\\
 (17) &  RULC & Real unit labour cost & (9) / (13)\\
 (18) &   NULC & Nominal unit labour cost & (9) / (14)\\
\bottomrule
\end{tabular}
\caption{Vrednosti spremenljivk Indicator in Descriptor v tabeli \texttt{RULC\_VA\_NACE\_letni}}
\end{table}
\footnotetext[4]{V primeru geografskih in SKD agregatov in so stalne cene za dodano vrednost izračunane in CP in PYP vrednosti objavljenih v isti tabeli.}

**Value** - ker gre za dolgo tabelo, so vse vrednosti v stolpcu `Value`, spremenljivka pa je identificirana v stolpcih `Indicator` oz. `Descriptor`


**YOY, Indeks2005, Indeks2007, Indeks2008** za vsako vrenost je izračunana medletna sprememba, ter trije indeksi z baznimi leti 2005, 2007, 2008 in 2019.



## Tabela `RULC_BDP_total_cetrtletni` {#Sec:rulcqtot}

*Skripta*: [04_RULC_cetrtletno.R](#Sec:skripta4) (poglavje \@ref(Sec:skripta4))

*Prejšnja lokacija tabele*: `RULC_q.accdb` tabela `Q_total`

**geo**: 

* 28 držav članic
* štirje originalni agregati iz Eurostata 
* sedem dodatnih agregatov, izračunanih iz podatkov posameznih držav:

\begin{table}[H]
\scriptsize
\centering
\begin{tabular}{ll}
\toprule
\textbf{Oznaka} & \textbf{Opis}  \\
\midrule
SI, AT... & 28 EU držav (vključno z UK) - uporabljene so dvomestne ISO oznake \\
\midrule
EU28 & EU do Brexita (samo do leta 2019) \\
EU15 & stare EU članice pred Brexitom (samo do leta 2019) \\
EA19& območje Evra pred pristopom Hrvaške \\ 
EU27\_2020 & EU članice po Brexitu \\
\midrule
EU13& nove EU članice po 2004  \\ 
EU14& stare EU članice po Brexitu \\
EU27noIE & EU članice po Brexitu  brez Irske \\
EA20 & območje Evra po pristopu Hrvaške   \\
EAnoIE & Evro območje brez Irske (po pristopu Hrvaške) \\
inovatorke & vodilne inovatorke - trenutno DK, SE, FI in NL\\
V4 & Višegrajske 4:CZ, HU, SK, PL \\
\bottomrule
\end{tabular}
\caption{Vrednosti v stolpcu geo}
\end{table}


**time** datum - prvi dan četrtletja

**Indicator** & **Descriptor**

V spodnji tabeli so prikazane vrednosti spremenljivk Indicator in Descriptor v tabeli, v zadnjem stolpcu pa tudi vir za vsako oz. preračun. 

\begin{table}[H]
\scriptsize
\centering
\begin{tabular}{clll}
\toprule
\textbf{\#} & \textbf{Indicator} & \textbf{Descriptor} & \textbf{Vir / Preračun} \\
\midrule
 (1) & GDP\_nom & BDP tekoče cene & namq\_10\_gdp\\
 (2) & GDP\_real & BDP stalne cene 2010 & namq\_10\_gdp \\
 (3) & COMP\_nom & sredstva za zaposlene & namq\_10\_gdp\\
 (4) & COMP\_SAL\_nom & plače & namq\_10\_gdp\\
 (5) & COMP\_CONTR\_nom & socialni prispevki & namq\_10\_gdp\\
 (6) & THS\_HW\_EMP\_DC & zaposlenost - delovne ure (1000) & namq\_10\_a10\_e\\
 (7) & THS\_HW\_SAL\_DC & zaposleni - delovne ure (1000)& namq\_10\_a10\_e\\
 (8) &  THS\_HW\_SELF\_DC & samozaposleni - delovne ure (1000)& namq\_10\_a10\_e\\
 (9) &  THS\_PER\_EMP\_DC & zaposlenost (1000)& namq\_10\_a10\_e\\
 (10) & THS\_PER\_SAL\_DC & zaposleni (1000)& namq\_10\_a10\_e\\
 (11) & THS\_PER\_SELF\_DC & samozaposleni (1000)& namq\_10\_a10\_e\\
 \midrule
 (12) & deflator\_GDP & deflator BDP & (1) / (2)\\
 (13) & COMP\_nom\_EMP & sredstva na 1000 zaposlenih - nom. & (1) / (10)\\
 (14) & COMP\_real\_EMP & sredstva na 1000 zaposlenih - real.& (1) / (10) / (12)\\
 (15) & COMP\_nom\_HW & sredstva na 1000 delovnih ur - nom. & (1) / (7)\\
 (16) & COMP\_real\_HW & sredstva na 1000 delovnih ur - real.& (1) / (7) / (12)\\
 (17) &  PROD\_nom\_EMP & produktivnost & (1) / (9) \\
 (18) &  PROD\_real\_EMP & realna produktivnost & (2) / (9)\\
 (19) &  PROD\_nom\_HW & produktivnost na delovno uro & (2) / (6)\\
 (20) &  PROD\_real\_HW & realna produktivnost na delovno uro & (2) / (6)\\
 (21) &  RULC & Real unit labour cost & (13) / (17)\\
 (22) &   NULC & Nominal unit labour cost & (13) / (18)\\
\bottomrule
\end{tabular}
\caption{Vrednosti spremenljivk Indicator in Descriptor v tabeli \texttt{RULC\_BDP\_total\_cetrtletni}}
\end{table}

**Value** - ker gre za dolgo tabelo, so vse vrednosti v stolpcu `Value`, spremenljivka pa je identificirana v stolpcih `Indicator` oz. `Descriptor`

**YOY, Indeks2005, Indeks2007, Indeks2008** za vsako vrenost je izračunana medletna sprememba, ter štirje indeksi z baznimi leti 2005, 2007, 2008 in 2019. 


## Tabela `RULC_VA_NACE_cetrtletni` {#Sec:rulcqnace}

*Skripta*: [04_RULC_cetrtletno.R](#Sec:skripta4) (poglavje \@ref(Sec:skripta4))

*Prejšnja lokacija tabele*: `RULC_q.accdb` tabela `Q_NACE`


**nace_r2**: Poleg originalnih 12 NACE klasifikacij, je dodanih še šest naših:

\begin{table}[H]
\scriptsize
\centering
\begin{tabular}{ll}
\toprule
\textbf{nace\_r2} & \textbf{opis}  \\
\midrule                                                        
TOTAL             & Total - all NACE activities         \\                                
A                 & Agriculture, forestry and fishing     \\                            
B-E               & Industry (except construction)          \\    
BDE               & Mining, electricity and water supply                  \\
C                 & Manufacturing                             \\                        
F                 & Construction                                \\                      
G-I               & Wholesale and retail trade, transport, accommodation and food ser...\\
J                 & Information and communication                                     \\
K                 & Financial and insurance activities                                \\
L                 & Real estate activities                                            \\
M\_N              & Professional, scientific and technical activities; administrative...\\
O-Q               & Public administration, defence, education, human health and socia...\\
R-U               & Arts, entertainment and recreation; other service activities; act...\\
 \midrule                                                        
Menjalni   & A, B-E, G-I, J                                                    \\
Nemenjalni & F, K, L, M\_N, O-Q, R-U                                            \\
Poslovni   & B-E, F, G-I, J, K, M\_N                                            \\
Neposlovni & A, L, O-Q, R-U                                                    \\
Tržni              & G-I, J, K, L, M\_N                                                 \\
Ostali          & A, BDE, O-Q, R-U \\
\bottomrule
\end{tabular}
\caption{Vrednosti spremenljivk nace\_r2  tabeli \texttt{RULC\_VA\_NACE\_cetrtletni}}
\label{tab:nace}
\end{table}

**geo**: 

* 28 držav članic
* štirje originalni agregati iz Eurostata 
* osem dodatnih agregatov, izračunanih iz podatkov posameznih držav: ^[Uporaba realnih indikatorjev za te dodatne agregate pomeni seštevanje neaditivnih vrednosti, zato previdno!]

\begin{table}[H]
\scriptsize
\centering
\begin{tabular}{ll}
\toprule
\textbf{Oznaka} & \textbf{Opis}  \\
\midrule
SI, AT... & 28 EU držav (vključno z UK) - uporabljene so dvomestne ISO oznake \\
\midrule
EU28 & EU do Brexita (samo do leta 2019) \\
EU15 & stare EU članice pred Brexitom (samo do leta 2019) \\
EA19& območje Evra pred pristopom Hrvaške \\ 
EU27\_2020 & EU članice po Brexitu \\
\midrule
EU13& nove EU članice po 2004  \\ 
EU14& stare EU članice po Brexitu \\
EU27& EU članice po Brexitu - isto kot EU27\_2020, samo se pravilno sešteje \\
EU27noIE & EU članice po Brexitu  brez Irske \\
EA20 & območje Evra po pristopu Hrvaške   \\
EAnoIE & Evro območje brez Irske (po pristopu Hrvaške) \\
inovatorke & vodilne inovatorke - trenutno DK, SE, FI in NL\\
V4 & Višegrajske 4:CZ, HU, SK, PL \\
\bottomrule
\end{tabular}
\caption{Vrednosti v stolpcu geo}
\end{table}


**time** datum - prvi dan četrtletja

**Indicator** & **Descriptor**

Spodaj so prikazane možne vrednosti spremenljivk Indicator in Descriptor v tabeli, v zadnjem stolpcu pa tudi vir za vsako oz. preračun. 

\begin{table}[H]
\scriptsize
\centering
\begin{tabular}{clll}
\toprule
\textbf{\#} & \textbf{Indicator} & \textbf{Descriptor} & \textbf{Vir / Preračun} \\
\midrule
 (1) & VA\_nom          & DV tekoče cene & namq\_10\_gdp\\
 (2) & VA\_real & DV stalne cene 2010 & namq\_10\_gdp \\
 (3) & COMP\_nom & sredstva za zaposlene & namq\_10\_gdp\\
 (4) &THS\_HW\_EMP\_DC & zaposlenost - delovne ure & namq\_10\_a10\_e\\
 (5) & THS\_HW\_SAL\_DC & zaposleni - delovne ure & namq\_10\_a10\_e\\
 (6) &  THS\_PER\_EMP\_DC & zaposlenost & namq\_10\_a10\_e\\
 (7) & THS\_PER\_SAL\_DC & zaposleni & namq\_10\_a10\_e\\
 \midrule
 (8) & deflator\_VA & deflator DV & (1) / (2)\\ 
 (9) & COMP\_nom\_EMP & sredstva na 1000 zaposlenih - nom. & (1) / (7)\\
 (10) & COMP\_real\_EMP & sredstva na 1000 zaposlenih - real.& (1) / (7) / (8)\\
 (11) & COMP\_nom\_HW & sredstva na 1000 delovnih ur - nom. & (1) / (5)\\
 (12) & COMP\_real\_HW & sredstva na 1000 delovnih ur - real.& (1) / (5) / (8)\\
 (13) &  PROD\_nom\_EMP & produktivnost & (1) / (6) \\
 (14) &  PROD\_real\_EMP & realna produktivnost & (2) / (6)\\
 (15) &  PROD\_nom\_HW & produktivnost na delovno uro & (1) / (4)\\
 (16) &  PROD\_real\_HW & realna produktivnost na delovno uro & (2) / (4)\\
 (17) &  RULC & Real unit labour cost & (9) / (13)\\
 (18) &   NULC & Nominal unit labour cost & (9) / (14)\\
\bottomrule
\end{tabular}
\caption{Vrednosti spremenljivk Indicator in Descriptor v tabeli \texttt{RULC\_VA\_NACE\_cetrtletni}}
\end{table}

**Value** - ker gre za dolgo tabelo, so vse vrednosti v stolpcu `Value`, spremenljivka pa je identificirana v stolpcih `Indicator` oz. `Descriptor`


**YOY, Indeks2005, Indeks2007, Indeks2008, Indeks2019** za vsako vrenost je izračunana medletna sprememba, ter štirje indeksi z baznimi leti 2005, 2007, 2008 in 2019. **Indeks2005_4cds**, **Indeks2007_4cds**, **Indeks2008_4cds** in **Indeks2019_4cds**so 4-četrtletne drseče sredine (desno poravnane) teh štirih indeksov. 




## Tabela `SURS_shift_share_cetrtletni` {#Sec:sursssq}

*Skripta*: [05_SURS_RULC_strukt_cetrtletno.R](#Sec:skripta5) (poglavje \@ref(Sec:skripta5))

*Prejšnja lokacija tabele*: `SURS_PROD_RULC.accdb` tabela `prod_q`

**time** datum - prvi dan četrtletja

**SKD** & **DEJAVNOST** na voljo so SKD agregati v spodnji tabeli. Poleg originalnih iz Si-Stata je dodanih še šest dodatnih agregatov.

\begin{table}[H]
\scriptsize
\centering
\begin{tabular}{ll}
\toprule
\textbf{SKD} & \textbf{DEJAVNOST}  \\
\midrule                                                        
 A          &A Kmetijstvo, lov, gozdarstvo, ribištvo                    \\              
 BCDE       &BCDE Rudarstvo, predelovalne dejavnosti, oskrba z elektriko in vodo, ravnanje z odplakami, saniranje okolja\\
 C          &..od tega: C Predelovalne dejavnosti\\
 BDE        &Rudarstvo, oskrba z elektriko in vodo, ravnanje z odplakami, saniranje okolja\\
 F          &F Gradbeništvo                                                           \\
 GHI        &GHI Trgovina in popravila vozil, promet in skladiščenje, gostinstvo      \\
 J          &J Informacijske in komunikacijske dejavnosti                             \\
 K          &K Finančne in zavarovalniške dejavnosti                                  \\
 L          &L Poslovanje z nepremičninami                                            \\
 MN         &MN Strokovne, znanstvene, tehnične dejavnosti in druge raznovrstne poslovne dejavnosti\\
 OPQ        &OPQ Uprava in obramba, izobraževanje, zdravstvo in socialno varstvo      \\
 RST        &RST Druge storitvene dejavnosti  \\
 \midrule                                                        
 Nemenjalni & F, K, L, MN, OPQ, RST                        \\                                      
 Menjalni   & A, BCDE, GHI, J                             \\                                    
 Neposlovni & A, L, OPQ, RST                             \\                                  
 Poslovni   & BCDE, F, GHI, J, K, MN      \\
 Tržne      & GHI, J, K, L, MN \\
 Ostale     & A, BDE, OPQ, RS \\
 SKUPAJ     & Dejavnost - SKUPAJ    \\
\bottomrule
\end{tabular}
\caption{Vrednosti spremenljivk SKD in DEJAVNOST v tabeli \texttt{SURS\_shift\_share\_cetrtletni}}
\label{tab:skd}
\end{table}

### Vsebinske sprememnljivke  {#Sec:sursssvs}

\begin{table}[H]
\scriptsize
\centering
\begin{tabular}{clll}
\toprule
\textbf{\#} & \textbf{Oznaka} & \textbf{Opis} & \textbf{Vir / Preračun} \\
\midrule
(1) & VA\_nom & Dodana vrednost, tekoče cene, v mio EUR & 0300220S \\
(2) & VA\_share\_nom & delež nom. dodane vrednosti v sektorju & (1) / $\Sigma$(1)\\
(3) & VA\_real & Dodana vrednost, stalne cene (2010), v mio EUR & 0300220S \\
(4) & VA\_share\_real & delež real. dodane vrednosti v sektorju & (3) / $\Sigma$(3)\\
(5) & EMP\_HW & Delovne ure, domači koncept, v 1000 & 0300260S \\
(6) & EMP\_PER & Zaposlenost, domači koncept, v 1000 & 0300260S \\
\midrule
(7) & EMP\_share & delež zaposlenih v sektorju & (6) / $\Sigma$(6) \\
(8) & PROD\_real\_EMP & realna produktivnost na zaposlenega & (3) / (6) \\
(9) & PROD\_nom\_EMP & nominalna produktivnost na zaposlenega & (1) / (6) \\
(10) & PROD\_diff\_EMP & sprememba realne produktivnosti na zaposlenega & (8) - $(8)_{t-1}$ \\
(11) & PROD\_yoy\_EMP & medletna rast realne produktivnosti na zaposlenega & ((8) / $(8)_{t-1}$ -100) *100  \\
(12) & EMP\_share\_diff & sprememba deleža zaposlenih v sektorju & (6) - $(6)_{t-1}$ \\
(13) & WITHIN\_effect\_EMP & znotrajsektorska rast produktivnosti na zaposlenega & (10) $\times (7)_{t-1}$ \\
(14) & STATIC\_shift\_EMP & statični strukturni učinek rasti produktivnosti na zaposlenega & (12) $\times (8)_{t-1}$ \\
(15) & DYNAMIC\_shift\_EMP & dinamični strukturni učinek rasti produktivnosti na zaposlenega & (12) $\times$ (10) \\
(16) & STRUCT\_shift\_EMP & dinamični strukturni učinek rasti produktivnosti na zaposlenega & (14) + (15)\\
\midrule
(17) & HW\_share & delež delovnih ur v sektorju & (5) / $\Sigma$(5)\\
(18) & PROD\_real\_HW & realna produktivnost na delovno uro & (3) / (5) \\
(19) & PROD\_nom\_HW & nominalna produktivnost na delovno uro & (1) / (5) \\
(20) & PROD\_diff\_HW & sprememba realne produktivnosti na delovno uro & (18) - $(18)_{t-1}$ \\
(21) & PROD\_yoy\_HW & medletna rast realne produktivnosti na delovno uro &  ((18) / $(18)_{t-1}$ -100) *100  \\
(22) & HW\_share\_diff & sprememba deleža deleža delovnih ur v sektorju & (17) - $(17)_{t-1}$ \\
(23) & WITHIN\_effect\_HW & znotrajsektorska rast produktivnosti na delovno uro & (20) $\times (17)_{t-1}$ \\
(24) & STATIC\_shift\_HW & statični strukturni učinek rasti produktivnosti na delovno uro & (22) $\times (18)_{t-1}$ \\
(25) & DYNAMIC\_shift\_HW & dinamični strukturni učinek rasti produktivnosti na delovno uro & (22) $\times$ (20) \\
(26) & STRUCT\_shift\_HW & dinamični strukturni učinek rasti produktivnosti na delovno uro & (24) + (25)\\
\bottomrule
\end{tabular}
\caption{Spremenljivke v tabeli \texttt{SURS\_shift\_share\_cetrtletni}}
\end{table}



## Tabela `SURS_RULC_VA_SKD_cetrtletni ` {#Sec:sursrulcskdq}

*Skripta*: [05_SURS_RULC_strukt_cetrtletno.R](#Sec:skripta5) (poglavje \@ref(Sec:skripta5))

*Prejšnja lokacija tabele*: `SURS_PROD_RULC.accdb` tabela `RULC_q`

**time** datum - prvi dan četrtletja

**SKD** & **DEJAVNOST** na voljo so SKD agregati v spodnji tabeli. Poleg originalnih iz Si-Stata je dodanih še šest dodatnih agregatov.


\begin{table}[H]
\scriptsize
\centering
\begin{tabular}{ll}
\toprule
\textbf{SKD} & \textbf{DEJAVNOST}  \\
\midrule                                                        
 A          &A Kmetijstvo, lov, gozdarstvo, ribištvo                    \\              
 BCDE       &BCDE Rudarstvo, predelovalne dejavnosti, oskrba z elektriko in vodo, ravnanje z odplakami, saniranje okolja\\
 C          &..od tega: C Predelovalne dejavnosti\\
 BDE        &Rudarstvo, oskrba z elektriko in vodo, ravnanje z odplakami, saniranje okolja\\
 F          &F Gradbeništvo                                                           \\
 GHI        &GHI Trgovina in popravila vozil, promet in skladiščenje, gostinstvo      \\
 J          &J Informacijske in komunikacijske dejavnosti                             \\
 K          &K Finančne in zavarovalniške dejavnosti                                  \\
 L          &L Poslovanje z nepremičninami                                            \\
 MN         &MN Strokovne, znanstvene, tehnične dejavnosti in druge raznovrstne poslovne dejavnosti\\
 OPQ        &OPQ Uprava in obramba, izobraževanje, zdravstvo in socialno varstvo      \\
 RST        &RST Druge storitvene dejavnosti  \\
 \midrule                                                        
 Nemenjalni & F, K, L, MN, OPQ, RST                        \\                                      
 Menjalni   & A, BCDE, GHI, J                             \\                                    
 Neposlovni & A, L, OPQ, RST                             \\                                  
 Poslovni   & BCDE, F, GHI, J, K, MN      \\
 Tržne      & GHI, J, K, L, MN \\
 Ostale     & A, BDE, OPQ, RS \\
 SKUPAJ     & Dejavnost - SKUPAJ    \\
\bottomrule
\end{tabular}
\caption{Vrednosti spremenljivk SKD in DEJAVNOST v tabeli \texttt{SURS\_shift\_share\_cetrtletni}}
\label{tab:skd2}
\end{table}


**Indicator** & **Descriptor**

Spodaj so prikazane možne vrednosti spremenljivk Indicator in Descriptor v tabeli, v zadnjem stolpcu pa tudi vir za vsako oz. preračun. 

\begin{table}[H]
\scriptsize
\centering
\begin{tabular}{clll}
\toprule
\textbf{\#} & \textbf{Indicator} & \textbf{Descriptor} & \textbf{Vir / Preračun} \\
\midrule
 (1) & VA\_nom  & DV tekoče cene & 0300220S\\
 (2) & VA\_real & DV stalne cene 2010 & 0300220S \\
 (3) & EMP\_PER & zaposlenost (1000) & 0300260S\\
 (4) & EMP\_HW  & zaposlenost - delovne ure (1000) & 0300260S\\
 (5) & SAL\_PER & zaposleni (1000)  & 0300260S\\
 (6) & SAL\_HW & zaposleni  delovne ure (1000)  & 0300260S\\
 (7) & COMP\_nom & sredstva za zaposlene & 0300240S \\
 \midrule
 (8) & deflator\_VA & deflator DV & (1) / (2)\\ 
 (9) & COMP\_nom\_EMP & sredstva na 1000 zaposlenih - nom. & (1) / (5)\\
 (10) & COMP\_real\_EMP & sredstva na 1000 zaposlenih - real.& (1) / (5) / (8)\\
 (11) & COMP\_nom\_HW & sredstva na 1000 delovnih ur - nom. & (1) / (6)\\
 (12) & COMP\_real\_HW & sredstva na 1000 delovnih ur - real.& (1) / (6) / (8)\\
 (13) &  PROD\_nom\_EMP & produktivnost & (1) / (3) \\
 (14) &  PROD\_real\_EMP & realna produktivnost & (2) / (3)\\
 (15) &  PROD\_nom\_HW & produktivnost na delovno uro & (1) / (4)\\
 (16) &  PROD\_real\_HW & realna produktivnost na delovno uro & (2) / (4)\\
 (17) &  RULC & Real unit labour cost & (9) / (13)\\
 (18) &   NULC & Nominal unit labour cost & (9) / (14)\\
\bottomrule
\end{tabular}
\caption{Vrednosti spremenljivk Indicator in Descriptor v tabeli \texttt{SURS\_RULC\_VA\_SKD\_cetrtletni}}
\label{tab:sursruclq}
\end{table}

**Value** - ker gre za dolgo tabelo, so vse vrednosti v stolpcu `Value`, spremenljivka pa je identificirana v stolpcih `Indicator` oz. `Descriptor`


**YOY, Indeks2005, Indeks2007, Indeks2008, Indeks2019** za vsako vrenost je izračunana medletna sprememba, ter štirje indeksi z baznimi leti 2005, 2007, 2008 in 2019. **Indeks2005_4cds**, **Indeks2007_4cds**, **Indeks2008_4cds** in **Indeks2019_4cds**so 4-četrtletne drseče sredine (desno poravnane) teh štirih indeksov. 

**LETO** & **Q** - letnica in kvartal




## Tabela `SURS_RULC_BDP_total_cetrtletni  ` {#Sec:sursrucltotq}

*Skripta*: [05_SURS_RULC_strukt_cetrtletno.R](#Sec:skripta5) (poglavje \@ref(Sec:skripta5))

*Prejšnja lokacija tabele*: `SURS_PROD_RULC.accdb` tabela `TOT_RULC_q`

**time** datum - prvi dan četrtletja

**season_adj** : možnosti sta "Originalni podatki" in "Podatki z izločenimi vplivi sezone in koledarja"

**Indicator** & **Descriptor**

Spodaj so prikazane možne vrednosti spremenljivk Indicator in Descriptor v tabeli, v zadnjem stolpcu pa tudi vir za vsako oz. preračun. 

\begin{table}[H]
\scriptsize
\centering
\begin{tabular}{clll}
\toprule
\textbf{\#} & \textbf{Indicator} & \textbf{Descriptor} & \textbf{Vir / Preračun} \\
\midrule
 (1) & GDP\_nom  & BDP tekoče cene & 0300220S\\
 (2) & GDP\_real & BDP stalne cene 2010 & 0300220S \\
 (3) & EMP\_PER & zaposlenost (1000) & 0300260S\\
 (4) & EMP\_HW  & zaposlenost - delovne ure (1000) & 0300260S\\
 (5) & SAL\_PER & zaposleni (1000)  & 0300260S\\
 (6) & SAL\_HW & zaposleni  delovne ure (1000)  & 0300260S\\
 (7) & COMP\_nom & sredstva za zaposlene & 0300240S \\
 \midrule
 (8) & deflator\_GDP & deflator BDP & (1) / (2)\\ 
 (9) & COMP\_nom\_EMP & sredstva na 1000 zaposlenih - nom. & (1) / (5)\\
 (10) & COMP\_real\_EMP & sredstva na 1000 zaposlenih - real.& (1) / (5) / (8)\\
 (11) & COMP\_nom\_HW & sredstva na 1000 delovnih ur - nom. & (1) / (6)\\
 (12) & COMP\_real\_HW & sredstva na 1000 delovnih ur - real.& (1) / (6) / (8)\\
 (13) &  PROD\_nom\_EMP & produktivnost & (1) / (3) \\
 (14) &  PROD\_real\_EMP & realna produktivnost & (2) / (3)\\
 (15) &  PROD\_nom\_HW & produktivnost na delovno uro & (1) / (4)\\
 (16) &  PROD\_real\_HW & realna produktivnost na delovno uro & (2) / (4)\\
 (17) &  RULC & Real unit labour cost & (9) / (13)\\
 (18) &   NULC & Nominal unit labour cost & (9) / (14)\\
\bottomrule
\end{tabular}
\caption{Vrednosti spremenljivk Indicator in Descriptor v tabeli \texttt{SURS\_RULC\_BDP\_total\_cetrtletni}}
\label{tab:sursrucltotq}
\end{table}

**Value** - ker gre za dolgo tabelo, so vse vrednosti v stolpcu `Value`, spremenljivka pa je identificirana v stolpcih `Indicator` oz. `Descriptor`


**YOY, Indeks2005, Indeks2007, Indeks2008, Indeks2019** za vsako vrenost je izračunana medletna sprememba, ter štirje indeksi z baznimi leti 2005, 2007, 2008 in 2019. **Indeks2005_4cds**, **Indeks2007_4cds**, **Indeks2008_4cds** in **Indeks2019_4cds**so 4-četrtletne drseče sredine (desno poravnane) teh štirih indeksov. 

**LETO** & **Q** - letnica in kvartal

## Tabela `SURS_shift_share_letni` {#Sec:sursssa}

*Skripta*: [06_SURS_RULC_strukt_letno.R](#Sec:skripta6) (poglavje \@ref(Sec:skripta6))

*Prejšnja lokacija tabele*: `SURS_PROD_RULC.accdb` tabela `prod_A_det`

**LETO** letnica

**SKD**  & **DEJAVNOST** poleg "Skupaj", so dejavnosti na voljo v tej tabeli kombinacija 1. in 2. ravni SKD in sicer tako, da so vse dejavnosti na 1. ravni, na 2. ravni pa so disagregirani samo izbrani sektorji. V spodnji tabeli so označeni v stolpcu 2. raven, niso pa tudi posebej našteti. Poleg originalnih iz Si-Stata je dodanih še 14 dodatnih agregatov opisanih v spodnjem delu tabele.

\begin{table}[H]
\scriptsize
\centering
\begin{tabular}{lll}
\toprule
\textbf{SKD}\ & textbf{DEJAVNOST} &   \textbf{2. raven}\\
\midrule                                                        
A &Kmetijstvo in lov, gozdarstvo, ribištvo & \checkmark\\                    
B &Rudarstvo (05-09) & --- \\                                          
C &Predelovalne dejavnosti & \checkmark \\                                    
D &Oskrba z električno energijo, plinom in paro (35) & ---\\          
E &Oskrba z vodo, ravnanje z odplakami in skrb za okolje & \checkmark \\      
F &Gradbeništvo (41-43) &---\\                                       
G &Trgovina, vzdrževanje in popravila vozil & \checkmark\\                   
H &Promet in skladiščenje & \checkmark\\                                     
I &Gostinstvo (55-56) &---\\                                         
J &Informacijske in komunikacijske dejavnosti & \checkmark\\                 
K &Finančne in zavarovalniške dejavnosti & \checkmark\\                      
L &Poslovanje z nepremičninami (68) & ---\\                           
M &Strokovne, znanstvene in tehnične dejavnosti  & \checkmark\\               
N &Druge raznovrstne poslovne dejavnosti & \checkmark\\                      
O &Dejavnosti uprave in obrambe, obvezna socialna varnost (84) & \checkmark\\
P &Izobraževanje (85) & \checkmark\\                                         
Q &Zdravstvo in socialno varstvo & \checkmark\\                              
R &Kulturne, razvedrilne in rekreacijske dejavnosti & \checkmark\\           
S &Druge dejavnosti & \checkmark\\                                           
T &Dejavnost gospodinjstev z zaposlenim osebjem (97-98) &--- \\       
U &Dejavnost eksteritorialnih organizacij in teles (99) &--- \\
\midrule   
 Nemenjalni & F, K, L, M, N, O, P, Q, R, S, T &               \\                                    
 Menjalni   & A, B, C, D, E, G, H, I, J         &                    \\                              
 Neposlovni & A, L, OPQ, RST      &                       \\                                  
 Poslovni   & BCDE, F, GHI, J, K, MN    &  \\
 High tech manuf & 21, 26 \\
 Med-high tech manuf & 20, 27, 28, 29, 30\\
 Med-low tech manuf & 19, 22, 23, 24, 25 \\
 Low tech manuf & 10, 11, 12, 13, 14, 15, 16, 17, 18, 31, 32\\
 Knowledge market services & J, M \\
 Rest market services & H, G, I, K, N \\
 Tržni      & GHI, J, K, L, MN &\\
 Ostali     & A, BDE, OPQ, RS &\\
 Energetsko intenzivni & 17, 20, 23, 24 \\
 Predelovalni neenergetski & 10, 11, 12, 13, 14, 15, 16, 18, 19, 21, 22, 25, 26, 27, 28, 29, 30, 31, 32, 33 \\
 SKUPAJ     & Dejavnost - SKUPAJ    &\\
\bottomrule
\end{tabular}
\caption{Vrednosti spremenljivke DEJAVNOST v tabeli \texttt{SURS\_shift\_share\_letni}}
\end{table}

**aggr** vrednost `level_` za SKD alfa oznake na 1. ravni, `level_2` za oznake na 2. ravni in `aggr` za agregirane vrednosti (Skupaj)


### Vsebinske sprememnljivke  {#Sec:sursssvsa}

\begin{table}[H]
\scriptsize
\centering
\begin{tabular}{clll}
\toprule
\textbf{\#} & \textbf{Oznaka} & \textbf{Opis} & \textbf{Vir / Preračun} \\
\midrule
(1) & VA\_nom & Dodana vrednost, tekoče cene, v mio EUR & 0301915S \\
(2) & VA\_share\_nom & delež nom. dodane vrednosti v sektorju & (1) / $\Sigma$(1)\\
(3) & VA\_real & Dodana vrednost, stalne cene (2010), v mio EUR & 0301915S \footnotemark \\
(4) & VA\_share\_real & delež real. dodane vrednosti v sektorju & (3) / $\Sigma$(3)\\
(5) & EMP\_HW & Delovne ure, domači koncept, v 1000 & 0301975S \\
(6) & EMP\_PER & Zaposlenost, domači koncept, v 1000 & 0301975S \\
\midrule
(7) & EMP\_share & delež zaposlenih v sektorju & (6) / $\Sigma$(6) \\
(8) & PROD\_real\_EMP & realna produktivnost na zaposlenega & (3) / (6) \\
(9) & PROD\_nom\_EMP & nominalna produktivnost na zaposlenega & (1) / (6) \\
(10) & PROD\_diff\_EMP & sprememba realne produktivnosti na zaposlenega & (8) - $(8)_{t-1}$ \\
(11) & PROD\_yoy\_EMP & medletna rast realne produktivnosti na zaposlenega & ((8) / $(8)_{t-1}$ -100) *100  \\
(12) & EMP\_share\_diff & sprememba deleža zaposlenih v sektorju & (6) - $(6)_{t-1}$ \\
(13) & WITHIN\_effect\_EMP & znotrajsektorska rast produktivnosti na zaposlenega & (10) $\times (7)_{t-1}$ \\
(14) & STATIC\_shift\_EMP & statični strukturni učinek rasti produktivnosti na zaposlenega & (12) $\times (8)_{t-1}$ \\
(15) & DYNAMIC\_shift\_EMP & dinamični strukturni učinek rasti produktivnosti na zaposlenega & (12) $\times$ (10) \\
(16) & STRUCT\_shift\_EMP & dinamični strukturni učinek rasti produktivnosti na zaposlenega & (14) + (15)\\
\midrule
(17) & HW\_share & delež delovnih ur v sektorju & (5) / $\Sigma$(5)\\
(18) & PROD\_real\_HW & realna produktivnost na delovno uro & (3) / (5) \\
(19) & PROD\_nom\_HW & nominalna produktivnost na delovno uro & (1) / (5) \\
(20) & PROD\_diff\_HW & sprememba realne produktivnosti na delovno uro & (18) - $(18)_{t-1}$ \\
(21) & PROD\_yoy\_HW & medletna rast realne produktivnosti na delovno uro &  ((18) / $(18)_{t-1}$ -100) *100  \\
(22) & HW\_share\_diff & sprememba deleža deleža delovnih ur v sektorju & (17) - $(17)_{t-1}$ \\
(23) & WITHIN\_effect\_HW & znotrajsektorska rast produktivnosti na delovno uro & (20) $\times (17)_{t-1}$ \\
(24) & STATIC\_shift\_HW & statični strukturni učinek rasti produktivnosti na delovno uro & (22) $\times (18)_{t-1}$ \\
(25) & DYNAMIC\_shift\_HW & dinamični strukturni učinek rasti produktivnosti na delovno uro & (22) $\times$ (20) \\
(26) & STRUCT\_shift\_HW & dinamični strukturni učinek rasti produktivnosti na delovno uro & (24) + (25)\\
\bottomrule
\end{tabular}
\caption{Spremenljivke v tabeli \texttt{SURS\_shift\_share\_letni}}
\label{tab:sursssvs}
\end{table}
\footnotetext[5]{V primeru SKD agregatov in so stalne cene za dodano vrednost izračunane in CP in PYP vrednosti objavljenih v isti tabeli.}


## Tabela `SURS_RULC_VA_SKD_letni ` {#Sec:sursrulcskda}

*Skripta*: [06_SURS_RULC_strukt_letno.R](#Sec:skripta6) (poglavje \@ref(Sec:skripta6))

*Prejšnja lokacija tabele*: `SURS_PROD_RULC.accdb` tabela `RULC_A`

**LETO** letnica 


**SKD**  & **DEJAVNOST** poleg "Skupaj", so dejavnosti na voljo v tej tabeli kombinacija 1. in 2. ravni SKD in sicer tako, da so vse dejavnosti na 1. ravni, na 2. ravni pa so disagregirani samo izbrani sektorji. V spodnji tabeli so označeni v stolpcu 2. raven, niso pa tudi posebej našteti. Poleg originalnih iz Si-Stata je dodanih še 14 dodatnih agregatov.

\begin{table}[H]
\scriptsize
\centering
\begin{tabular}{lll}
\toprule
\textbf{SKD}\ & \textbf{DEJAVNOST} &   \textbf{2. raven}\\
\midrule                                                        
A &Kmetijstvo in lov, gozdarstvo, ribištvo & \checkmark\\                    
B &Rudarstvo (05-09) & --- \\                                          
C &Predelovalne dejavnosti & \checkmark \\                                    
D &Oskrba z električno energijo, plinom in paro (35) & ---\\          
E &Oskrba z vodo, ravnanje z odplakami in skrb za okolje & \checkmark \\      
F &Gradbeništvo (41-43) &---\\                                       
G &Trgovina, vzdrževanje in popravila vozil & \checkmark\\                   
H &Promet in skladiščenje & \checkmark\\                                     
I &Gostinstvo (55-56) &---\\                                         
J &Informacijske in komunikacijske dejavnosti & \checkmark\\                 
K &Finančne in zavarovalniške dejavnosti & \checkmark\\                      
L &Poslovanje z nepremičninami (68) & ---\\                           
M &Strokovne, znanstvene in tehnične dejavnosti  & \checkmark\\               
N &Druge raznovrstne poslovne dejavnosti & \checkmark\\                      
O &Dejavnosti uprave in obrambe, obvezna socialna varnost (84) & \checkmark\\
P &Izobraževanje (85) & \checkmark\\                                         
Q &Zdravstvo in socialno varstvo & \checkmark\\                              
R &Kulturne, razvedrilne in rekreacijske dejavnosti & \checkmark\\           
S &Druge dejavnosti & \checkmark\\                                           
T &Dejavnost gospodinjstev z zaposlenim osebjem (97-98) &--- \\       
U &Dejavnost eksteritorialnih organizacij in teles (99) &--- \\
\midrule   
 Nemenjalni & F, K, L, MN, OPQ, RST &                       \\                                      
 Menjalni   & A, BCDE, GHI, J         &                    \\                                    
 Neposlovni & A, L, OPQ, RST      &                       \\                                  
 Poslovni   & BCDE, F, GHI, J, K, MN    &  \\
 High tech manuf & 21, 26 \\
 Med-high tech manuf & 20, 27, 28, 29, 30\\
 Med-low tech manuf & 19, 22, 23, 24, 25 \\
 Low tech manuf & 10, 11, 12, 13, 14, 15, 16, 17, 18, 31, 32\\
 Knowledge market services & J, M \\
 Rest market services & H, G, I, K, N \\
 Tržni      & GHI, J, K, L, MN &\\
 Ostali     & A, BDE, OPQ, RS &\\
 Energetsko intenzivni & 17, 20, 23, 24 \\
 Predelovalni neenergetski & 10, 11, 12, 13, 14, 15, 16, 18, 19, 21, 22, 25, 26, 27, 28, 29, 30, 31, 32, 33 \\
 SKUPAJ     & Dejavnost - SKUPAJ    &\\
\bottomrule
\end{tabular}
\caption{Vrednosti spremenljivke DEJAVNOST v tabeli \texttt{SURS\_RULC\_VA\_SKD\_letni}}
\end{table}

**aggr** vrednost `level_` za SKD alfa oznake na 1. ravni, `level_2` za oznake na 2. ravni in `aggr` za agregirane vrednosti (Skupaj)

**Indicator** & **Descriptor**

Spodaj so prikazane možne vrednosti spremenljivk Indicator in Descriptor v tabeli, v zadnjem stolpcu pa tudi vir za vsako oz. preračun. 

\begin{table}[H]
\scriptsize
\centering
\begin{tabular}{clll}
\toprule
\textbf{\#} & \textbf{Indicator} & \textbf{Descriptor} & \textbf{Vir / Preračun} \\
\midrule
 (1) & VA\_nom  & DV tekoče cene & 0301915S\\
 (2) & VA\_real & DV stalne cene 2010 & 0301915S \footnotemark \\
 (3) & EMP\_PER & zaposlenost (1000) & 0301975S\\
 (4) & EMP\_HW  & zaposlenost - delovne ure (1000) & 0301975S\\
 (5) & SAL\_PER & zaposleni (1000)  & 0301975S\\
 (6) & SAL\_HW & zaposleni  delovne ure (1000)  & 0301975S\\
 (7) & COMP\_nom & sredstva za zaposlene & 0301930S \\
 \midrule
 (8) & deflator\_VA & deflator DV & (1) / (2)\\ 
 (9) & COMP\_nom\_EMP & sredstva na 1000 zaposlenih - nom. & (1) / (5)\\
 (10) & COMP\_real\_EMP & sredstva na 1000 zaposlenih - real.& (1) / (5) / (8)\\
 (11) & COMP\_nom\_HW & sredstva na 1000 delovnih ur - nom. & (1) / (6)\\
 (12) & COMP\_real\_HW & sredstva na 1000 delovnih ur - real.& (1) / (6) / (8)\\
 (13) &  PROD\_nom\_EMP & produktivnost & (1) / (3) \\
 (14) &  PROD\_real\_EMP & realna produktivnost & (2) / (3)\\
 (15) &  PROD\_nom\_HW & produktivnost na delovno uro & (1) / (4)\\
 (16) &  PROD\_real\_HW & realna produktivnost na delovno uro & (2) / (4)\\
 (17) &  RULC & Real unit labour cost & (9) / (13)\\
 (18) &   NULC & Nominal unit labour cost & (9) / (14)\\
\bottomrule
\end{tabular}
\caption{Vrednosti spremenljivk Indicator in Descriptor v tabeli \texttt{SURS\_RULC\_VA\_SKD\_letni}}
\label{tab:sursrucla}
\end{table}
\footnotetext[6]{V primeru SKD agregatov in so stalne cene za dodano vrednost izračunane in CP in PYP vrednosti objavljenih v isti tabeli.}

**Value** - ker gre za dolgo tabelo, so vse vrednosti v stolpcu `Value`, spremenljivka pa je identificirana v stolpcih `Indicator` oz. `Descriptor`

**YOY, Indeks2005, Indeks2007, Indeks2008, Indeks2019** za vsako vrenost je izračunana medletna sprememba, ter štirje indeksi z baznimi leti 2005, 2007, 2008 in 2019.





## Tabela `SURS_RULC_BDP_total_letni  ` {#Sec:sursrucltota}

*Skripta*: [06_SURS_RULC_strukt_letno.R](#Sec:skripta6) (poglavje \@ref(Sec:skripta6))

*Prejšnja lokacija tabele*: `SURS_PROD_RULC.accdb` tabela `TOT_RULC_A`

**LETO** - letnica 

**Indicator** & **Descriptor**

Spodaj so prikazane možne vrednosti spremenljivk Indicator in Descriptor v tabeli, v zadnjem stolpcu pa tudi vir za vsako oz. preračun. 

\begin{table}[H]
\scriptsize
\centering
\begin{tabular}{clll}
\toprule
\textbf{\#} & \textbf{Indicator} & \textbf{Descriptor} & \textbf{Vir / Preračun} \\
\midrule
 (1) & GDP\_nom  & BDP tekoče cene & 0301910S\\
 (2) & GDP\_real & BDP stalne cene 2010 & 0301910S \\
 (3) & EMP\_PER & zaposlenost (1000) & 0301975S\\
 (4) & EMP\_HW  & zaposlenost - delovne ure (1000) & 0301975S\\
 (5) & SAL\_PER & zaposleni (1000)  & 0301975S\\
 (6) & SAL\_HW & zaposleni  delovne ure (1000)  & 0301975S\\
 (7) & COMP\_nom & sredstva za zaposlene & 0301925S \\
 \midrule
 (8) & deflator\_GDP & deflator BDP & (1) / (2)\\ 
 (9) & COMP\_nom\_EMP & sredstva na 1000 zaposlenih - nom. & (1) / (5)\\
 (10) & COMP\_real\_EMP & sredstva na 1000 zaposlenih - real.& (1) / (5) / (8)\\
 (11) & COMP\_nom\_HW & sredstva na 1000 delovnih ur - nom. & (1) / (6)\\
 (12) & COMP\_real\_HW & sredstva na 1000 delovnih ur - real.& (1) / (6) / (8)\\
 (13) &  PROD\_nom\_EMP & produktivnost & (1) / (3) \\
 (14) &  PROD\_real\_EMP & realna produktivnost & (2) / (3)\\
 (15) &  PROD\_nom\_HW & produktivnost na delovno uro & (1) / (4)\\
 (16) &  PROD\_real\_HW & realna produktivnost na delovno uro & (2) / (4)\\
 (17) &  RULC & Real unit labour cost & (9) / (13)\\
 (18) &   NULC & Nominal unit labour cost & (9) / (14)\\
\bottomrule
\end{tabular}
\caption{Vrednosti spremenljivk Indicator in Descriptor v tabeli \texttt{SURS\_RULC\_BDP\_total\_letni}}
\label{tab:sursrucltota}
\end{table}

**Value** - ker gre za dolgo tabelo, so vse vrednosti v stolpcu `Value`, spremenljivka pa je identificirana v stolpcih `Indicator` oz. `Descriptor`

**YOY, Indeks2005, Indeks2007, Indeks2008, Indeks2019** za vsako vrenost je izračunana medletna sprememba, ter štirje indeksi z baznimi leti 2005, 2007, 2008 in 2019.

\newpage
# Baza `produktivnost` - tehnična dokumentacija

Na PostgreSQL strežniku na `umar-bi` (PostgreSQL 15) je več podatkovnih baz, za namene centralnega skladiščenja in dostopa do podatkov za produktivnost je bila postavljena nova baza z imenom `produktivnost`.

Vse tabele se nahajajo znotraj sheme `produktivnost` (najvišja strukturna raven znotraj baze), po potrebi lahko dodamo več shem in razdelimo tabele v vsebinske sklope. 

## Dostopanje do baze

**Dostop do baze je mogoč samo z uporabniškim imenom in geslom, ki ga lahko dodeli administrator Postgres strežnika (trenutno mz).**

Na bazi se doda novega uporabnika takole:
```
select current_database();
CREATE USER peter_wostner WITH PASSWORD 'xxx';

-- Grant usage on the schema
GRANT USAGE ON SCHEMA produktivnost TO peter_wostner;

-- Grant select on all current tables in the schema
GRANT SELECT ON ALL TABLES IN SCHEMA produktivnost TO peter_wostner;

-- Ensure future tables inherit these permissions
ALTER DEFAULT PRIVILEGES IN SCHEMA produktivnost GRANT SELECT ON TABLES TO peter_wostner;
```

Poleg dodajanja novih uporabnikov z `USAGE` in `SELECT` pravicami na bazi, je za vsakega uporabnika potrebno tudi v `pg_hba.conf` dodati njihove IP-je (službenega in domačega), da jim steržnik dovoli povezavo. 

In dotičnega uporabnika dodaš tudi v `umar_produktivnost/R/update_eurostat.R` in `update_surs.R` pod email list, da dobi email kadarkoli se posodobijio podatki. 

### Excel Data Connection / Power Query

#### Pred prvo povezavo
Pred prvo uporabo povezave je potrebno inštalirati ODBC driver za postgres (Open Database Connectivity), ki ga dobiš na [https://www.postgresql.org/ftp/odbc/releases/](https://www.postgresql.org/ftp/odbc/releases/). Izbereš zadnjo verzijo in znotraj mape izbereš 64 bitno verzijo `.msi` datoteke in jo preneseš. **Za namestitev rabiš admin pravice, zato rečeš Petru, da ti on uredi!**

Naslednji korak: `Control panel` / `Admin Tools` / `ODBC Data Sources (64 bit)`, na prvem zavihku izbereš `Add` in iz seznama izbereš `PostgreSQL Unicode(x64)` in potem `Finish`. Potem izpoloniš setup polja:

* `Data Source`: to je ime, po katerem boš povezavo spoznal, tako da recimo `produktivnost baza` ali kaj podobnega
* `Database`: produktivnost
* `Server`: 192.168.38.21
* `Port`: 5432
* `User Name`: svoje uporabniško ime (dobiš od Maje)
* `Password`: svoje geslo  (dobiš od Maje)

In še zadnji korak: odpri Excel, `Blank document`  in izberi `Data`, `Get Data`, `From other sources`, `From ODBC`  in iz seznama DNS izberi vir, ki si ga ravnokar poimenoval (torej "produktivnost baza" vz zgornjem primeru). Prvič, ko to narediš, te spet vpraša za uporabniško ime in geslo, kasneje pa tega ne bo več. 

#### Vsaka nadaljna povezava

Vsakič, ko hočeš dobiti podatke iz baze uporabiš sledeči postopek:

* odpreš Excel, in izbereš `Data` / `Get Data` / `From other sources` / `From ODBC`
* iz seznama `Data source names (DNS)` izbereš vir, kot si ga poimenoval in klikneš OK
* odpre se `Navigator`, kjer izbereš na katero tabelo se hočeš povezati in potem klikneš `Transform Data`, da se odpre Power Query (če namesto tega klikneš na `Load`, se ti bo prenesla cela tabela, česar ponavadi nočeš).


### R

#### Vzpostavitev povezave

Za povezovanje iz `R`-ja potrebuješ knjižnjici `DBI` in `RPostgres`, za lažje delo s poizvedbami pa tudi `dbplyr`, ki se integrira z `dplyr`-jem:

```
# install.packages("DBI")
# install.packages("RPostgres")
# install.packages("dbplyr")
```
Povezavo vsakič vzpostaviš z naslednjo kodo, kjer vstaviš uporabniško ime in geslo (uporabi narekovaje okoli obeh):

```
con <- DBI::dbConnect(RPostgres::Postgres(),
                      dbname = "produktivnost",
                      host = "192.168.38.21",
                      port = 5432,
                      user = <uporabniško ime>,
                      password = <geslo>)
DBI::dbExecute(con, "set search_path to produktivnost")                      
```
Dodanta priporočila za avtentikacijo v R-u. Namesto, da imaš passworde izpisane kot zgoraj, jih daš v .Renviron fajl in so potem vendo dostopni in jih ni treba kopirati naokoli ali spreminjati. Najlažje je z `usethis::edit_r_environ("user")`, kar ta ti bo enostavno odprl ta prav fajl na pravi lokaciji in v njega napišeš tole:

`PG_PSW="Dspi0dBs23Us4fJyQ"` (seveda s svojim geslom)

Potem v zgornjo kodo za `con` namesto neposrednega gesla napišeš `Sys.getenv(PG_PSW)`. 

#### Dostopanje do podatkov 

Takole pa potem dostopaš do podatkov: npr. najprej poglej katere tabele so na voljo in potem naredi poizvedbo. 

```
# poglej najprej, če je kaka tabela tam
DBI::dbListTables(con)
```
Uporabljaš lahko običajne "pipe", samo na začetku moraš uporabiti `tbl()` da se povežeš in na koncu `collect()` da ti vrne tabelo:
```
# naredi poizvedno na tabeli: 
tbl(con, "produktivnost_makro") |>
  filter(geo == "EU27") |>
  collect()
  
```


## Vzpostavitev baze

...

`O:Avtomatizacija\umar_produktivnost\SQL\setup_produktivnost_tables.R` vsebuje skripto z SQL ukazi uporabljenimi za postavitev tabel na bazi. 

\newpage
\appendix 

# Priloga - razlike med eurostat agregati in ročno izračunanimi - Tabela `produktivnost_makro` {#App:1}

Eurostat ima v tabeli `produktivnost_makro` štiri agregate že izračunane: EU28, EU15,  EA19 in EU27_2020. Ti agregati se ne ujemajo popolnoma z agregati, ki jih lahko sami izračunamo iz podatkov posameznih držav - kar delamo za ostalih 7 agregatov. 

Spodaj so prikazane *razlike* med Eurostat agregatom in ročno izračunanim agregatom za 5 glavnih spremenljivk v tej tabeli za EU19 (rdeče) in EU27_2020 (črno).

Zakaj do teh razlik prihaja, ni čisto jasno, sploh ker se dinamika odstopanja razlikuje glede na spremenljivko. Razlike niso velike (največja je 0.03% pri delovnih urah), ampak vseeno se priporoča, da se uporablja naše izračunane agregate, namesto Eurostatovih - sploh če se prikazuje več agregatov hkrati, da so vsi konsistentno izračunani na isti način. 


```{r, echo = FALSE, warning = FALSE, message = FALSE}
suppressPackageStartupMessages(library(dplyr))
```

```{r, echo = FALSE, fig.cap = "delta za EA19 in EU27 - BDP, tekoče cene, v mio SKM", fig.dim = c(8, 3), warning = FALSE, message = FALSE}

master <- readRDS("../data/master01.rds")
source("../R/00_geo_lookup.R")
master_tidy <- master |>
  inner_join(geo_lookup)
par(mar=c(2,4,1,1) + 0.1)
options(scipen = 999)
umar <- master_tidy |>
  group_by(na_item, time, unit,EA19) |>
  summarise(values = sum(values, na.rm = TRUE), .groups = 'drop') %>%
  mutate(geo = "EA19") |>
  filter(unit == "CP_MPPS_EU27_2020", na_item == "B1GQ", EA19 == TRUE) |> 
  pull(values)

eurostat <- master |>
 filter(geo == "EA19") |>
  filter(unit == "CP_MPPS_EU27_2020", na_item == "B1GQ") |> 
  pull(values)

umar2 <- master_tidy |>
  group_by(na_item, time, unit,EU27_2020) |>
  summarise(values = sum(values, na.rm = TRUE), .groups = 'drop') %>%
  mutate(geo = "EU27_2020") |>
  filter(unit == "CP_MPPS_EU27_2020", na_item == "B1GQ", EU27_2020 == TRUE) |> 
  pull(values)

eurostat2 <- master |>
 filter(geo == "EU27_2020") |>
  filter(unit == "CP_MPPS_EU27_2020", na_item == "B1GQ") |> 
  pull(values)

plot(1995:2023, (eurostat - umar) / eurostat , type = "l", col = "red", xlab = "", ylab = "delta Eurostat vs. Umar, v %")
legend("topleft", c("EA19", "EU27_2020"), col = c("red", "black"), lty = 1, cex = 0.8)
lines(1995:2023, (eurostat2 - umar2) / eurostat2)
lines(1995:2023, rep(0, 29))
```


```{r, echo = FALSE, fig.cap = "delta za EA19 in EU27 - BDP, stalne cene leta 2010, v mio EUR", fig.dim = c(8, 3), warning = FALSE, message = FALSE}
par(mar=c(2,4,1,1) + 0.1)

umar <- master_tidy |>
  group_by(na_item, time, unit,EA19) |>
  summarise(values = sum(values, na.rm = TRUE), .groups = 'drop') %>%
  mutate(geo = "EA19") |>
  filter(unit == "CLV10_MEUR", na_item == "B1GQ", EA19 == TRUE) |> 
  pull(values)

eurostat <- master |>
 filter(geo == "EA19") |>
  filter(unit == "CLV10_MEUR", na_item == "B1GQ") |> 
  pull(values)

umar2 <- master_tidy |>
  group_by(na_item, time, unit,EU27_2020) |>
  summarise(values = sum(values, na.rm = TRUE), .groups = 'drop') %>%
  mutate(geo = "EU27_2020") |>
  filter(unit == "CLV10_MEUR", na_item == "B1GQ", EU27_2020 == TRUE) |> 
  pull(values)

eurostat2 <- master |>
 filter(geo == "EU27_2020") |>
  filter(unit == "CLV10_MEUR", na_item == "B1GQ") |> 
  pull(values)

plot(1995:2023, (eurostat - umar) / eurostat , type = "l", col = "red", xlab = "", ylab = "delta Eurostat vs. Umar, v %")
legend("topleft", c("EA19", "EU27_2020"), col = c("red", "black"), lty = 1, cex = 0.8)
lines(1995:2023, (eurostat2 - umar2) / eurostat2)
lines(1995:2023, rep(0, 29))
```

```{r, echo = FALSE, fig.cap = "delta za EA19 in EU27 - Skupna zaposlenost, domači koncept, v 1000 oseb", fig.dim = c(8, 3), warning = FALSE, message = FALSE}
par(mar=c(2,4,1,1) + 0.1)
options(scipen = 999)
umar <- master_tidy |>
  group_by(na_item, time, unit,EA19) |>
  summarise(values = sum(values, na.rm = TRUE), .groups = 'drop') %>%
  mutate(geo = "EA19") |>
  filter(unit == "THS_PER", na_item == "EMP_DC", EA19 == TRUE) |> 
  pull(values)

eurostat <- master |>
 filter(geo == "EA19") |>
  filter(unit == "THS_PER", na_item == "EMP_DC") |> 
  pull(values)

umar2 <- master_tidy |>
  group_by(na_item, time, unit,EU27_2020) |>
  summarise(values = sum(values, na.rm = TRUE), .groups = 'drop') %>%
  mutate(geo = "EU27_2020") |>
  filter(unit == "THS_PER", na_item == "EMP_DC", EU27_2020 == TRUE) |> 
  pull(values)

eurostat2 <- master |>
 filter(geo == "EU27_2020") |>
  filter(unit == "THS_PER", na_item == "EMP_DC") |> 
  pull(values)

plot(1995:2023, (eurostat2 - umar2) / eurostat2 , type = "l", xlab = "", ylab = "delta Eurostat vs. Umar, v %")
legend("topleft", c("EA19", "EU27_2020"), col = c("red", "black"), lty = 1, cex = 0.8)
lines(1995:2023, (eurostat - umar) / eurostat,col = "red")
lines(1995:2023, rep(0, 29))
```

```{r, echo = FALSE, fig.cap = "delta za EA19 in EU27 - Delovne ure, domači koncept, v 1000", fig.dim = c(8, 3), warning = FALSE, message = FALSE}
par(mar=c(2,4,1,1) + 0.1)

umar <- master_tidy |>
  group_by(na_item, time, unit,EA19) |>
  summarise(values = sum(values, na.rm = TRUE), .groups = 'drop') %>%
  mutate(geo = "EA19") |>
  filter(unit == "THS_HW", na_item == "EMP_DC", EA19 == TRUE) |> 
  pull(values)

eurostat <- master |>
 filter(geo == "EA19") |>
  filter(unit == "THS_HW", na_item == "EMP_DC") |> 
  pull(values)

umar2 <- master_tidy |>
  group_by(na_item, time, unit,EU27_2020) |>
  summarise(values = sum(values, na.rm = TRUE), .groups = 'drop') %>%
  mutate(geo = "EU27_2020") |>
  filter(unit == "THS_HW", na_item == "EMP_DC", EU27_2020 == TRUE) |> 
  pull(values)

eurostat2 <- master |>
 filter(geo == "EU27_2020") |>
  filter(unit == "THS_HW", na_item == "EMP_DC") |> 
  pull(values)

plot(1995:2023, (eurostat2 - umar2) / eurostat2 , type = "l", xlab = "", ylab = "delta Eurostat vs. Umar, v %")
legend("topleft", c("EA19", "EU27_2020"), col = c("red", "black"), lty = 1, cex = 0.8)
lines(1995:2023, (eurostat - umar) / eurostat,col = "red")
lines(1995:2023, rep(0, 29))
```


```{r, echo = FALSE, fig.cap = "delta za EA19 in EU27 - Št. Prebivalcev, nacionalni koncept, v 1000", fig.dim = c(8, 3), warning = FALSE, message = FALSE}
par(mar=c(2,4,1,1) + 0.1)
options(scipen = 999)
umar <- master_tidy |>
  group_by(na_item, time, unit,EA19) |>
  summarise(values = sum(values, na.rm = TRUE), .groups = 'drop') %>%
  mutate(geo = "EA19") |>
  filter(unit == "THS_PER", na_item == "POP_NC", EA19 == TRUE) |> 
  pull(values)

eurostat <- master |>
 filter(geo == "EA19") |>
  filter(unit == "THS_PER", na_item == "POP_NC") |> 
  pull(values)


umar2 <- master_tidy |>
  group_by(na_item, time, unit,EU27_2020) |>
  summarise(values = sum(values, na.rm = TRUE), .groups = 'drop') %>%
  mutate(geo = "EU27_2020") |>
  filter(unit == "THS_PER", na_item == "POP_NC", EU27_2020 == TRUE) |> 
  pull(values)

eurostat2 <- master |>
 filter(geo == "EU27_2020") |>
  filter(unit == "THS_PER", na_item == "POP_NC") |> 
  pull(values)

plot(1995:2023, (eurostat2 - umar2) / eurostat2 , type = "l", xlab = "", ylab = "delta Eurostat vs. Umar, v %")
legend("topleft", c("EA19", "EU27_2020"), col = c("red", "black"), lty = 1, cex = 0.8)
lines(1995:2023, (eurostat - umar) / eurostat,col = "red")
lines(1995:2023, rep(0, 29))

```


# Priloga - razlike med uporabo prebivalstva iz tabele `nama_10_pe` in prebivalstva iz `demo_pjan` tabele - Tabela `produktivnost_makro`

Za izračun spremenljivke `BDP na prebivalca v SKM` se uporablja prebivalstvo po nacionalnem principu iz tabele `nama_10_pe`, kjer pa ni podatkov po starostnih skupinah. Za dekompozicijo spremenljivke po naslednji formuli:

$\displaystyle \frac{ BDP}{ preb} = \frac{ BDP}{ zap.} \times  \frac{ zap.}{ preb._{20-64}} \times \frac{ preb._{20-64}}{preb.}$

oz. opisno: BDP per capita `GDP_PC_PPS` je produkt:

+ produktivnosti -- `PROD_PPS`
+ deleža zaposlenih v prebivalstvu starosti 20-64 -- `EMP_W_AGE`
+ deleža prebivalstva starosti 20-64 v celotnem prebivalstvu -- `W_AGE_PROP`

moramo uporabiti podatke o prebivalstvu iz Eurostatove tabele `demo_pjan`, ker so samo tam podatki po starostnih skupinah, ki so potrebni za drugi dve komponenti. Definicija prebivalstva v tej tabeli je "*Usually resident population which represents the number of inhabitants of a given area on 1 January of the year in question (or on 31 December of the previous year).*"  

medtem ko je definicija v tabeli `nama_10_pe`: "*all persons, nationals or foreigners, who are permanently settled in the economic territory of the country, even if they are temporarily absent from it, on a given date. A person staying or intending to stay at least one year is considered to be settled on the territory. By convention, the total population excludes foreign students and members of foreign armed forces stationed in a country.*" Ker gre za pomožne indikatorje nacionalnim izračunom, so podatki na letni ravni oz. gre za vrednosti na sredini leta za razliko od demografskih podatkov v tabeli `demo_pjan`, ki veljajo na prvi dan leta. 

Za uporabo podatkov o številu prebivalstva v starostni skupini 20-64 torej moramo uporabiti podatke iz `demo_pjan`, kjer vzamemo povprečje dveh zaporednih let, da dobimo vrednost na sredini leta. V praksi to žal pomeni, da podatek za zadnje leto še ni dostopen, dokler ni objavljen podatek za tekoče leto. 

Problem pa se pojavi pri vprašanju katere podatke uporabiti za skupno število prebivalcev. Za BDP per capita (`GDP_PC_PPS`) se zdi smiselno uporabiti podatke, ki so skupaj objavljeni, torej prebivalstvo po nacionalnem konceptu sredi leta. Ampak za dekompozicijo, natančneje zadnjo komponento deleža prebivalstva starosti 20-64 v celotnem prebivalstvu (`W_AGE_PROP`), je seveda smiselno uporabiti prebivalstvo iz tabele `demo_pjan`, da sta v imenovalcu in števcu enaki definiciji prebivalstva. 

Spodaj je za Slovenijo, EU27, Nemčijo in Italijo prikazano kakšne so razlike med obema možnostima: na levi razlika med skupnim številom prebivalstva (rdeče linije so iz `demo_pjan`), na serdini razlika med zadnjo komponento, torej delež working age v skupnem prebivalstvu in na desni BDP per capita.


```{r, echo = FALSE, fig.cap = "Slovenija", fig.dim = c(8, 3), warning = FALSE, message = FALSE}

data_macro <- readRDS("../data/data_macro01.rds")
par(mfrow = c(1, 3))
par(mar=c(2,4,1,1) + 0.1)

data_macro |>
  filter(geo =="SI") ->x

plot(x$time,x$THS_PER_POP_NC, type = "l", ylab = "Skupaj prebivalcev (1000)")
lines(x$time,x$NR_TOTAL, col = "red")
legend("topleft", c("demo_pjan", "nama_10_pe"), col = c("red", "black"), lty = 1, cex = 0.8)

plot(x$time,x$W_AGE_PROP *100, type = "l", ylab = "procent 20-64 / skupaj preb.")
lines(x$time,x$W_AGE_PROP_pjan * 100, col = "red")

plot(x$time,x$GDP_PC_PPS, type = "l")
lines(x$time,x$GDP_PC_PPS_pjan, col = "red", ylab = "BDP per capita")

```

```{r, echo = FALSE, fig.cap = "EU27", fig.dim = c(8, 3), warning = FALSE, message = FALSE}

data_macro <- readRDS("../data/data_macro01.rds")
par(mfrow = c(1, 3))
par(mar=c(2,4,1,1) + 0.1)

data_macro |>
  filter(geo =="EU27") ->x

plot(x$time,x$THS_PER_POP_NC, type = "l", ylab = "Skupaj prebivalcev (1000)")
legend("topleft", c("demo_pjan", "nama_10_pe"), col = c("red", "black"), lty = 1, cex = 0.8)
lines(x$time,x$NR_TOTAL, col = "red")

plot(x$time,x$W_AGE_PROP *100, type = "l", ylab = "procent 20-64 / skupaj preb.")
lines(x$time,x$W_AGE_PROP_pjan * 100, col = "red")

plot(x$time,x$GDP_PC_PPS, type = "l")
lines(x$time,x$GDP_PC_PPS_pjan, col = "red", ylab = "BDP per capita")

```
Pri Nemčiji so razlike pred letom 2011 precej dramatične, kar je povezano s tem, da je Nemčija leta 2011 izvedla prvi popis na podlagi centralnih registrov, do takrat pa so ocene temeljine na podatkih popisa iz leta 1987. Ta popis 2011 je pokazal, da je prebivalcev v resnici cca 1.5 milijona manj, kot so pred tem ocenjevali. "Due to the long inter-censal period, the Federal Statistical Office of Germany decided not to produce backward-adjusted population estimates by single-year ages and sex for the whole period." ^[https://www.bib.bund.de/Publikation/2018/Adjusting-inter-censal-population-estimates-for-Germany-1987-2011.html?nn=1219476] Skratka očitno so popravke za nazaj naredili samo na skupnih podatkih (in so torej v `nama_10_pe` tabeli), ne pa na podatkih po starostih, zato je vsota v `demo_pjan` še vedno narobe, ker je niso nikoli popravili.


```{r, echo = FALSE, fig.cap = "Nemčija", fig.dim = c(8, 3), warning = FALSE, message = FALSE}

data_macro <- readRDS("../data/data_macro01.rds")
par(mfrow = c(1, 3))
par(mar=c(2,4,1,1) + 0.1)

data_macro |>
  filter(geo =="DE") ->x

plot(x$time,x$THS_PER_POP_NC, type = "l", ylab = "Skupaj prebivalcev (1000)")
legend("topleft", c("demo_pjan", "nama_10_pe"), col = c("red", "black"), lty = 1, cex = 0.8)
lines(x$time,x$NR_TOTAL, col = "red")

plot(x$time,x$W_AGE_PROP *100, type = "l", ylab = "procent 20-64 / skupaj preb.")
lines(x$time,x$W_AGE_PROP_pjan * 100, col = "red")

plot(x$time,x$GDP_PC_PPS, type = "l")
lines(x$time,x$GDP_PC_PPS_pjan, col = "red", ylab = "BDP per capita")

```
Za Italijo (spodaj) nisem našla kake elegantne razlage, sem pa vprašala Ale in čakam odgovor. 

```{r, echo = FALSE, fig.cap = "Italija", fig.dim = c(8, 3), warning = FALSE, message = FALSE}

data_macro <- readRDS("../data/data_macro01.rds")
par(mfrow = c(1, 3))
par(mar=c(2,4,1,1) + 0.1)

data_macro |>
  filter(geo =="IT") ->x

plot(x$time,x$NR_TOTAL, type = "l", ylab = "Skupaj prebivalcev (1000)", col = "red")
legend("topleft", c("demo_pjan", "nama_10_pe"), col = c("red", "black"), lty = 1, cex = 0.8)
lines(x$time,x$THS_PER_POP_NC)

plot(x$time,x$W_AGE_PROP *100, type = "l", ylab = "procent 20-64 / skupaj preb.")
lines(x$time,x$W_AGE_PROP_pjan * 100, col = "red")

plot(x$time,x$GDP_PC_PPS, type = "l")
lines(x$time,x$GDP_PC_PPS_pjan, col = "red", ylab = "BDP per capita")

```

